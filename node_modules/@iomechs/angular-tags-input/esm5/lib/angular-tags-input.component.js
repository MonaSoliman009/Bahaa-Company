import * as tslib_1 from "tslib";
import { ScrollStrategy, ScrollStrategyOptions } from '@angular/cdk/overlay';
import { Component, EventEmitter, forwardRef, Input, Output, ViewChild, ViewEncapsulation, HostListener, } from '@angular/core';
import { NG_VALUE_ACCESSOR, NG_VALIDATORS } from '@angular/forms';
import { AngularTagsInputService } from './angular-tags-input.service';
import { TagInputComponent } from './tag-input/tag-input.component';
import { UnAddedTagsPipe } from './un-added-tags.pipe';
import { DropdownComponent } from './dropdown/dropdown.component';
import { KEY_CODES } from './constants';
var AngularTagsInputComponent = /** @class */ (function () {
    function AngularTagsInputComponent(sso, tagsService) {
        this.sso = sso;
        this.tagsService = tagsService;
        this.tagsData = [];
        this.disabled = false;
        this.dropDownTemplate = null;
        this.tagItemTemplate = null;
        this.required = false;
        this.tagRemoved = new EventEmitter();
        this.tagAdded = new EventEmitter();
        this.valueChanged = new EventEmitter();
        this.itemClicked = new EventEmitter();
        this.tags = [];
        this.defaultConfig = {
            defaultClass: 'angular-tags-input',
            additionalClasses: '',
            displayProperty: 'value',
            identifier: 'id',
            onlyFromAutoComplete: false,
            placeholder: 'Search',
            hideAddedTags: true,
            nestedTagProperty: '',
            showTagsSelectedInDD: false,
            hideTags: false,
            maxItems: null,
            nestedTagParentProp: '',
            keyboardActiveClass: 'angular-tags-dropdown__list__item--active'
        };
        this.dropdownOverlayPosition = [
            { offsetY: 12, originX: 'start', originY: 'bottom', overlayX: 'start', overlayY: 'top' },
            { offsetY: -28, originX: 'start', originY: 'top', overlayX: 'start', overlayY: 'bottom' },
            { offsetY: 28, originX: 'end', originY: 'bottom', overlayX: 'end', overlayY: 'bottom' },
            { offsetY: -28, originX: 'end', originY: 'top', overlayX: 'end', overlayY: 'bottom' },
        ];
        this.unAddedTagsPipe = new UnAddedTagsPipe();
    }
    AngularTagsInputComponent.prototype.keyEvent = function (event) {
        this.inputKeyPress(event);
    };
    AngularTagsInputComponent.prototype.ngOnChanges = function (changes) {
        // if there's no change in the tagsData, do nothing
        if (!changes.tagsData || !this.isInputFocused) {
            return;
        }
        // If the previous walue was `null` or `undefined`, we're initializing that as an array here
        // so we can avoid breaking the process further.
        if (!changes.tagsData.previousValue) {
            changes.tagsData.previousValue = [];
        }
        // if we have the value of the tags changed, we need to show the dropdown immediately
        // we don't show this on the first change, because that's when the first value is assigned
        if (changes.tagsData && changes.tagsData.currentValue !== changes.tagsData.previousValue
            && !changes.tagsData.firstChange) {
            // if the values don't match, show the dropdown
            if (changes.tagsData.currentValue.length !== changes.tagsData.previousValue.length && !!this.dropdownShownYet) {
                return this.showDropdown(changes.tagsData.currentValue);
            }
            if (changes.tagsData.previousValue.length === 0) {
                return;
            }
            /* since the values are array, we need to compare the elements within
             * avoiding the usage of any external library, matching the elements using identifier
             * of the elements here
             */
            for (var i = 0, len = changes.tagsData.currentValue.length; i < len; ++i) {
                if (changes.tagsData.currentValue[i][this.config.identifier] !== changes.tagsData.previousValue[i][this.config.identifier]) {
                    // as soon as the difference in elements is found, show the element and stop further execution of for loop
                    return this.showDropdown(changes.tagsData.currentValue);
                }
            }
        }
    };
    AngularTagsInputComponent.prototype.onFocusChange = function (val) {
        var _this = this;
        this.isInputFocused = val;
        if (!val && this.config.hideDDOnBlur) {
            setTimeout(function () {
                _this.hideDropdown();
            }, 400);
        }
    };
    AngularTagsInputComponent.prototype.onInputValueChanged = function (val) {
        this.inputVal = val;
        this.valueChanged.emit(val);
    };
    AngularTagsInputComponent.prototype.ngOnInit = function () {
        this.config = tslib_1.__assign({}, this.defaultConfig, this.config);
        this.ddScrollStrategy = this.sso.reposition();
    };
    /**
     * @author Ahsan Ayaz
     * @desc Triggers when the value of the form control (or ngModel) is changed.
     * We're using the handler to assign the values to the tags array that we have.
     */
    AngularTagsInputComponent.prototype.writeValue = function (tags) {
        var _this = this;
        tags = tags ? tags : [];
        tags = Array.isArray(tags) ? tags : [tags];
        this.tags = tags.map(function (tag) {
            var _a;
            return tslib_1.__assign({}, tag, (_a = {},
                _a[_this.config.identifier] = tag[_this.config.identifier],
                _a[_this.config.displayProperty] = tag[_this.config.displayProperty],
                _a));
        });
        if (this.config.showTagsSelectedInDD) {
            setTimeout(function () {
                _this.tags.map(function (tag) {
                    _this.selectRelatedTags(tag);
                });
            });
        }
    };
    /**
     * @author Ahsan Ayaz
     * @desc Registers the on change function to the value accessor
     */
    AngularTagsInputComponent.prototype.registerOnChange = function (fn) {
        this.onChange = fn;
    };
    /**
     * Validator function for the form control
     * Doesn't do anything if the control is not required
     * If it is required, checks if the control contains value
     */
    AngularTagsInputComponent.prototype.validate = function (control) {
        if (this.required === false) {
            return null;
        }
        return (!!control.value && control.value.length) ? null : {
            required: true,
        };
    };
    /**
     * @author Ahsan Ayaz
     * @desc Triggers when the tag input is focused
     */
    AngularTagsInputComponent.prototype.onInputFocus = function () {
        if (this.config.clearInputOnFocus) {
            if (this.tagInput.lastValueEmitted !== '') {
                this.tagInput.tagInputForm.get('tagInputVal').setValue('');
            }
            this.tagInput.resetInput();
        }
        if (this.config.clearTagsOnFocus) {
            this.tags.length = 0;
        }
        this.showDropdown();
        this.onFocusChange(true);
    };
    /**
     * @author Ahsan Ayaz
     * @desc Shows the dropdown with options listing
     */
    AngularTagsInputComponent.prototype.showDropdown = function (recentTags) {
        if (recentTags === void 0) { recentTags = null; }
        var unAddedTags = this.unAddedTagsPipe.transform(!!recentTags ? recentTags : this.tagsData, {
            tagsAdded: this.tags,
            config: this.config
        });
        if (unAddedTags.length) { // only show dropdown when we have data to show
            this.isDropdownOpen = true;
        }
        if (!this.dropdownShownYet) {
            this.dropdownShownYet = true;
        }
    };
    /**
     * @author Ahsan Ayaz
     * @desc Hides the options listing dropdown
     */
    AngularTagsInputComponent.prototype.hideDropdown = function () {
        this.isDropdownOpen = false;
        this.tagsData = this.removeKeyboardSelection(this.tagsData);
    };
    AngularTagsInputComponent.prototype.removeKeyboardSelection = function (items) {
        var _this = this;
        return items.map(function (tag) {
            if (tag[_this.config.nestedTagProperty] && tag[_this.config.nestedTagProperty].length) {
                tag[_this.config.nestedTagProperty] = _this.removeKeyboardSelection(tag[_this.config.nestedTagProperty]);
            }
            return tslib_1.__assign({}, tag, { tiKeyboardActive: false });
        });
    };
    AngularTagsInputComponent.prototype.ngAfterViewInit = function () {
        if (!!this.config || !this.onChange) {
            console.warn('Please use ngModel or FormControlName with <ti-angular-tags-input>');
        }
        if (this.config.nestedTagProperty) {
            // we need the parent property to be able to unselect the parent when a child tag is unselected
            if (!this.config.nestedTagParentProp) {
                // tslint:disable-next-line:max-line-length
                throw new Error('nestedTagProperty provided but nestedTagParentProp not provided.\nThis will cause the parent tag to not remove if any of the children is removed');
            }
        }
    };
    /**
     * @author Ahsan Ayaz
     * @desc Adds the tag in the tags list (tags array).
     * Avoids duplicate tags addition
     * @param tag - tag to add
     */
    AngularTagsInputComponent.prototype.addTag = function (tag) {
        var _this = this;
        if (this.config.showTagsSelectedInDD) {
            tag.tiSelected = true; // marks the element as selected
        }
        if (this.config.maxItems > 0 && this.tags.length === this.config.maxItems) {
            return;
        }
        if (!this.tags.find(function (tagItem) { return tagItem[_this.config.identifier] === tag[_this.config.identifier]; })) {
            this.tags = tslib_1.__spread(this.tags, [tag]);
            this.onChange(this.tags);
        }
    };
    /**
     * @author Ahsan Ayaz
     * @desc Removes the tags from the tags list
     * @param tag - tag to remove
     */
    AngularTagsInputComponent.prototype.removeTag = function (tag) {
        var _this = this;
        this.tags = this.tags.filter(function (tagItem) { return tagItem[_this.config.identifier] !== tag[_this.config.identifier]; });
        // when we've removed all the tags, we want to get the default tags
        if (this.tags.length === 0) {
            this.tagInput.resetInput();
            this.valueChanged.emit('');
        }
        this.onChange(this.tags);
    };
    /**
     * @author Ahsan Ayaz
     * @desc Triggers when the item is clicked from the dropdown
     * @param tag - tag selected
     */
    AngularTagsInputComponent.prototype.onItemClicked = function (tag) {
        var _this = this;
        // if we don't have to toggle, add the item as tag right away
        if (this.config.toggleSelectionOnClick) {
            // we have to toggle selection. First, let's see if the tag doesn't exist already in the selected tags
            if (!tag.tiSelected && !this.tags.find(function (tagItem) { return tagItem[_this.config.identifier] === tag[_this.config.identifier]; })) {
                this.addTag(tag);
                this.selectRelatedTags(tag);
                this.tagAdded.emit(this.tagsService.getMainTagAfterAdding(this.tagsData, tag, this.tags, this.config));
            }
            else { // if the tag is already selected, remove
                this.removeTag(tag);
                this.removeTagSelection(tag);
                this.tagRemoved.emit(tag);
            }
        }
        else {
            this.addTag(tag);
            this.selectRelatedTags(tag);
            this.tagAdded.emit(this.tagsService.getMainTagAfterAdding(this.tagsData, tag, this.tags, this.config));
        }
        this.tagInput.resetInput();
        this.itemClicked.emit(tag);
        this.hideDropdown();
    };
    /**
     * @author Ahsan Ayaz
     * @desc Removes the tag seleced state (and of the children)
     * @param tag - the tag to unmark as selected
     */
    AngularTagsInputComponent.prototype.removeTagSelection = function (tag, ignoreChildren, ignoreParent) {
        var _this = this;
        if (ignoreChildren === void 0) { ignoreChildren = false; }
        if (ignoreParent === void 0) { ignoreParent = false; }
        tag.tiSelected = false;
        if (!ignoreChildren && tag[this.config.nestedTagProperty]) {
            for (var i = 0, len = tag[this.config.nestedTagProperty].length; i < len; ++i) {
                this.removeTag(tag[this.config.nestedTagProperty][i]);
                this.removeTagSelection(tag[this.config.nestedTagProperty][i], ignoreChildren);
            }
        }
        if (tag[this.config.nestedTagParentProp] && !ignoreParent) {
            var parentTag = this.tagsService.findTagById(this.tagsData, tag[this.config.nestedTagParentProp], this.config);
            if (parentTag && parentTag.tiSelected) {
                this.removeTag(parentTag);
                this.removeTagSelection(parentTag, true, ignoreParent);
                parentTag[this.config.nestedTagProperty].map(function (tagItem) {
                    // tslint:disable-next-line:triple-equals
                    if (tagItem[_this.config.identifier] != tag[_this.config.identifier]) {
                        _this.addTag(tagItem);
                        _this.selectRelatedTags(tagItem, false, true);
                    }
                });
            }
        }
        this.onChange(this.tags);
    };
    /**
     * @author Ahsan Ayaz
     * @desc triggers on close button click of the tags
     * @param tag - the tag to remove
     */
    AngularTagsInputComponent.prototype.tagCloseClicked = function (tag) {
        this.tagRemoved.emit(tag);
        this.removeTag(tag);
        this.removeTagSelection(tag);
    };
    /**
     * @author Ahsan Ayaz
     * @desc Selects/adds the retated tags (parent and/or children)
     * @param tag - the tag to mark as selected
     */
    AngularTagsInputComponent.prototype.selectRelatedTags = function (tag, ignoreChildren, ignoreParent) {
        var _this = this;
        if (ignoreChildren === void 0) { ignoreChildren = false; }
        if (ignoreParent === void 0) { ignoreParent = false; }
        if (this.config.showTagsSelectedInDD) {
            tag.tiSelected = true;
        }
        if (tag[this.config.nestedTagProperty] && !ignoreChildren) {
            for (var i = 0, len = tag[this.config.nestedTagProperty].length; i < len; ++i) {
                if (this.config.showParentTagsOnly) {
                    // remove the children if we only have to keep parent
                    this.removeTag(tag[this.config.nestedTagProperty][i]);
                    // making sure we're targeting only children, ignoring parents
                    this.selectRelatedTags(tag[this.config.nestedTagProperty][i], false, true);
                }
                else {
                    this.addTag(tag[this.config.nestedTagProperty][i]);
                }
            }
        }
        if (tag[this.config.nestedTagParentProp] && !ignoreParent) {
            var parentTag_1 = this.tagsService.findTagById(this.tagsData, tag[this.config.nestedTagParentProp], this.config);
            if (!parentTag_1) {
                return;
            }
            var parentTagChildren = parentTag_1[this.config.nestedTagProperty].length;
            var childrensSelected = this.tags.filter(function (tagItem) {
                // tslint:disable-next-line:triple-equals
                return tagItem[_this.config.nestedTagParentProp] == parentTag_1[_this.config.identifier];
            }).length;
            if ((parentTagChildren > 0 && childrensSelected > 0) &&
                (this.config.childrenCountProperty ?
                    childrensSelected === parentTag_1[this.config.childrenCountProperty] :
                    childrensSelected === parentTagChildren)) {
                this.addTag(parentTag_1);
                this.selectRelatedTags(parentTag_1, false, false);
            }
        }
        this.onChange(this.tags);
    };
    AngularTagsInputComponent.prototype.registerOnTouched = function (fn) {
        // throw new Error("Method not implemented.");
    };
    AngularTagsInputComponent.prototype.inputKeyPress = function ($event) {
        var _this = this;
        $event.stopImmediatePropagation();
        if (!this.isDropdownOpen &&
            ($event.key === KEY_CODES.ARROW_UP ||
                $event.key === KEY_CODES.ARROW_DOWN)) {
            this.isDropdownOpen = true;
        }
        else if (this.isDropdownOpen &&
            $event.key === KEY_CODES.ESCAPE) {
            return this.hideDropdown();
        }
        // so we have the dropdown shown
        setTimeout(function () {
            if (_this.dropdown) {
                _this.dropdown.handleKeyUp($event);
            }
        }, 10);
    };
    AngularTagsInputComponent.ctorParameters = function () { return [
        { type: ScrollStrategyOptions },
        { type: AngularTagsInputService }
    ]; };
    tslib_1.__decorate([
        ViewChild(DropdownComponent, { static: false })
    ], AngularTagsInputComponent.prototype, "dropdown", void 0);
    tslib_1.__decorate([
        Input()
    ], AngularTagsInputComponent.prototype, "config", void 0);
    tslib_1.__decorate([
        Input()
    ], AngularTagsInputComponent.prototype, "tagsData", void 0);
    tslib_1.__decorate([
        Input()
    ], AngularTagsInputComponent.prototype, "disabled", void 0);
    tslib_1.__decorate([
        Input()
    ], AngularTagsInputComponent.prototype, "tagsLoading", void 0);
    tslib_1.__decorate([
        Input()
    ], AngularTagsInputComponent.prototype, "dropDownTemplate", void 0);
    tslib_1.__decorate([
        Input()
    ], AngularTagsInputComponent.prototype, "tagItemTemplate", void 0);
    tslib_1.__decorate([
        Input()
    ], AngularTagsInputComponent.prototype, "required", void 0);
    tslib_1.__decorate([
        Output()
    ], AngularTagsInputComponent.prototype, "tagRemoved", void 0);
    tslib_1.__decorate([
        Output()
    ], AngularTagsInputComponent.prototype, "tagAdded", void 0);
    tslib_1.__decorate([
        Output()
    ], AngularTagsInputComponent.prototype, "valueChanged", void 0);
    tslib_1.__decorate([
        Output()
    ], AngularTagsInputComponent.prototype, "itemClicked", void 0);
    tslib_1.__decorate([
        ViewChild(TagInputComponent, { static: true })
    ], AngularTagsInputComponent.prototype, "tagInput", void 0);
    tslib_1.__decorate([
        HostListener('keyup', ['$event'])
    ], AngularTagsInputComponent.prototype, "keyEvent", null);
    AngularTagsInputComponent = tslib_1.__decorate([
        Component({
            selector: 'ti-angular-tags-input',
            template: "<div\n  class=\"angular-tags-input\"\n  [ngClass]=\"config.defaultClass + ' ' + config.additionalClasses\">\n  <div class=\"angular-tags-input__inp-container\" #dropdownTrigger=\"cdkOverlayOrigin\" cdkOverlayOrigin>\n    <ng-container *ngIf=\"!config.hideTags\">\n      <ti-tag\n        class=\"angular-tags-input__inp-container__tag\"\n        *ngFor=\"let tagItem of tags\"\n        [config]=\"config\"\n        [tagItem]=\"tagItem\"\n        [tagItemTemplate]=\"tagItemTemplate\"\n        (closeClicked)=\"tagCloseClicked($event)\">\n      </ti-tag>\n    </ng-container>\n    <ti-tag-input\n      [style.display]=\"config.hideInputOnSelection && tags.length ? 'none' : 'block'\"\n      [config]=\"config\"\n      [disabled]=\"disabled\"\n      class=\"angular-tags-input__inp-container__tag-input\"\n      (tagEntered)=\"addTag($event)\"\n      (valueChanged)=\"onInputValueChanged($event)\"\n      (inputFocused)=\"onInputFocus()\"\n      (inputBlurred)=\"onFocusChange(false);\"\n      (inputKeyPress)=\"inputKeyPress($event)\">\n    </ti-tag-input>\n  </div>\n  \n  <ng-template cdkConnectedOverlay [cdkConnectedOverlayOrigin]=\"dropdownTrigger\" [cdkConnectedOverlayOpen]=\"isDropdownOpen\"\n    [cdkConnectedOverlayHasBackdrop]=\"config.ddHasBackdrop\" (backdropClick)=\"hideDropdown()\"\n    [cdkConnectedOverlayPanelClass]=\"'angular-tags-input-dd-overlay' + config.dropdownClass ? config.dropdownClass : ''\"\n    [cdkConnectedOverlayScrollStrategy]=\"ddScrollStrategy\"\n    [cdkConnectedOverlayPositions]=\"dropdownOverlayPosition\"\n    [cdkConnectedOverlayMinWidth]=\"310\">\n    <div class=\"angular-tags-input__dd-container\">\n      <ti-dropdown\n        [inputVal]=\"inputVal\"\n        (itemClicked)=\"onItemClicked($event);\"\n        [dropDownTemplate]=\"dropDownTemplate\"\n        [listItems]=\"tagsData | unAddedTags: {tagsAdded: tags, config: config}\"\n        [config]=\"config\"\n        (itemAdded)=\"addTag($event);\">\n      </ti-dropdown>\n    </div>\n  </ng-template>\n</div>\n",
            providers: [
                getAngularTagsInputValueAccessor(),
                getAngularTagsInputValidatorsProvider()
            ],
            encapsulation: ViewEncapsulation.None,
            styles: ["ti-angular-tags-input{display:block;width:100%}.angular-tags-input{display:flex;flex-direction:row;align-items:center;margin:-3px 0}.angular-tags-input__inp-container{width:100%;display:flex;flex-direction:row;align-items:center;background:#fff;flex-wrap:wrap;padding:9px 18px 18px;position:relative;top:4px}.angular-tags-input__inp-container__tag-input{flex:1}.angular-tags-input__inp-container__tag{margin:0 10px 8px 0}.angular-tags-input__dd-container{display:block;width:100%}.cdk-overlay-container.select-assignee-overlay{z-index:1050}.cdk-overlay-container.task-menu-popover-overlay{z-index:2050}.duplicate-modal-overlay{z-index:999}.cdk-overlay-backdrop{display:block}.cdk-global-overlay-wrapper,.cdk-overlay-container{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{display:block;position:fixed;z-index:1000}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute;z-index:1000}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;background-color:#fff;z-index:1000;display:flex;max-width:100%;max-height:100%;border:1px solid #fff;box-shadow:0 2px 14px 4px rgba(0,0,0,.1)}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;z-index:1000;pointer-events:auto;-webkit-tap-highlight-color:transparent;transition:opacity .4s cubic-bezier(.25,.8,.25,1);opacity:0}"]
        })
    ], AngularTagsInputComponent);
    return AngularTagsInputComponent;
}());
export { AngularTagsInputComponent };
export function getAngularTagsInputValueAccessor() {
    return {
        provide: NG_VALUE_ACCESSOR,
        useExisting: forwardRef(function () { return AngularTagsInputComponent; }),
        multi: true,
    };
}
export function getAngularTagsInputValidatorsProvider() {
    return {
        provide: NG_VALIDATORS,
        useExisting: forwardRef(function () { return AngularTagsInputComponent; }),
        multi: true,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci10YWdzLWlucHV0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bpb21lY2hzL2FuZ3VsYXItdGFncy1pbnB1dC8iLCJzb3VyY2VzIjpbImxpYi9hbmd1bGFyLXRhZ3MtaW5wdXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDN0UsT0FBTyxFQUVMLFNBQVMsRUFDVCxZQUFZLEVBQ1osVUFBVSxFQUNWLEtBQUssRUFHTCxNQUFNLEVBR04sU0FBUyxFQUNULGlCQUFpQixFQUNqQixZQUFZLEdBQ2IsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUF3QixpQkFBaUIsRUFBRSxhQUFhLEVBQTBCLE1BQU0sZ0JBQWdCLENBQUM7QUFFaEgsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDdkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFcEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFZeEM7SUEyQ0UsbUNBQ21CLEdBQTBCLEVBQ25DLFdBQW9DO1FBRDNCLFFBQUcsR0FBSCxHQUFHLENBQXVCO1FBQ25DLGdCQUFXLEdBQVgsV0FBVyxDQUF5QjtRQTFDckMsYUFBUSxHQUFlLEVBQUUsQ0FBQztRQUMxQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBRWpCLHFCQUFnQixHQUFxQixJQUFJLENBQUM7UUFDMUMsb0JBQWUsR0FBcUIsSUFBSSxDQUFDO1FBQ3pDLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDaEIsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDaEMsYUFBUSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDOUIsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2xDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUUzQyxTQUFJLEdBQTBCLEVBQUUsQ0FBQztRQUdqQyxrQkFBYSxHQUEyQjtZQUN0QyxZQUFZLEVBQUUsb0JBQW9CO1lBQ2xDLGlCQUFpQixFQUFFLEVBQUU7WUFDckIsZUFBZSxFQUFFLE9BQU87WUFDeEIsVUFBVSxFQUFFLElBQUk7WUFDaEIsb0JBQW9CLEVBQUUsS0FBSztZQUMzQixXQUFXLEVBQUUsUUFBUTtZQUNyQixhQUFhLEVBQUUsSUFBSTtZQUNuQixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLG9CQUFvQixFQUFFLEtBQUs7WUFDM0IsUUFBUSxFQUFFLEtBQUs7WUFDZixRQUFRLEVBQUUsSUFBSTtZQUNkLG1CQUFtQixFQUFFLEVBQUU7WUFDdkIsbUJBQW1CLEVBQUUsMkNBQTJDO1NBQ2pFLENBQUM7UUFFRiw0QkFBdUIsR0FBRztZQUN4QixFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRTtZQUN4RixFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFO1lBQ3pGLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFO1lBQ3ZGLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUU7U0FDdEYsQ0FBQztRQUlGLG9CQUFlLEdBQUcsSUFBSSxlQUFlLEVBQUUsQ0FBQztJQUlwQyxDQUFDO0lBSUwsNENBQVEsR0FBUixVQUFTLEtBQUs7UUFDWixJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCwrQ0FBVyxHQUFYLFVBQVksT0FBc0I7UUFDaEMsbURBQW1EO1FBQ25ELElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUM3QyxPQUFPO1NBQ1I7UUFFRCw0RkFBNEY7UUFDNUYsZ0RBQWdEO1FBQ2hELElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRTtZQUNuQyxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7U0FDckM7UUFDRCxxRkFBcUY7UUFDckYsMEZBQTBGO1FBQzFGLElBQ0UsT0FBTyxDQUFDLFFBQVEsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLFlBQVksS0FBSyxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWE7ZUFDakYsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFDaEM7WUFDQSwrQ0FBK0M7WUFDL0MsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxNQUFNLEtBQUssT0FBTyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7Z0JBQzdHLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ3pEO1lBRUQsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUMvQyxPQUFPO2FBQ1I7WUFFRDs7O2VBR0c7WUFDSCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUU7Z0JBQ3hFLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFO29CQUMxSCwwR0FBMEc7b0JBQzFHLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO2lCQUN6RDthQUNGO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsaURBQWEsR0FBYixVQUFjLEdBQVk7UUFBMUIsaUJBT0M7UUFOQyxJQUFJLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQztRQUMxQixJQUFJLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFO1lBQ3BDLFVBQVUsQ0FBQztnQkFDVCxLQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDdEIsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ1Q7SUFDSCxDQUFDO0lBRUQsdURBQW1CLEdBQW5CLFVBQW9CLEdBQVc7UUFDN0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUM7UUFDcEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELDRDQUFRLEdBQVI7UUFDRSxJQUFJLENBQUMsTUFBTSx3QkFDTixJQUFJLENBQUMsYUFBYSxFQUNsQixJQUFJLENBQUMsTUFBTSxDQUNmLENBQUM7UUFDRixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILDhDQUFVLEdBQVYsVUFBVyxJQUFnQjtRQUEzQixpQkFvQkM7UUFuQkMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDeEIsSUFBSSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBQyxHQUFHOztZQUN2Qiw0QkFDSyxHQUFHO2dCQUVKLEdBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLElBQUcsR0FBRyxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDO2dCQUNyRCxHQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxJQUFHLEdBQUcsQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQztxQkFFakU7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsRUFBRTtZQUNwQyxVQUFVLENBQUM7Z0JBQ1QsS0FBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBQyxHQUFHO29CQUNoQixLQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzlCLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSCxvREFBZ0IsR0FBaEIsVUFBa0IsRUFBTztRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUNyQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILDRDQUFRLEdBQVIsVUFBUyxPQUFvQjtRQUMzQixJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssS0FBSyxFQUFFO1lBQzNCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUN4RCxRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsZ0RBQVksR0FBWjtRQUNFLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRTtZQUNqQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLEtBQUssRUFBRSxFQUFFO2dCQUN6QyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQzVEO1lBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUM1QjtRQUNELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRTtZQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7U0FDdEI7UUFDRCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsZ0RBQVksR0FBWixVQUFhLFVBQTZCO1FBQTdCLDJCQUFBLEVBQUEsaUJBQTZCO1FBQ3hDLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUNoRCxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQ3pDO1lBQ0UsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ3BCLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTTtTQUNwQixDQUNGLENBQUM7UUFDRixJQUFJLFdBQVcsQ0FBQyxNQUFNLEVBQUUsRUFBRSwrQ0FBK0M7WUFDdkUsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7U0FDNUI7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQzFCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7U0FDOUI7SUFDSCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsZ0RBQVksR0FBWjtRQUNFLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO1FBQzVCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQsMkRBQXVCLEdBQXZCLFVBQXdCLEtBQTRCO1FBQXBELGlCQVVDO1FBVEMsT0FBTyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQUMsR0FBbUI7WUFDbkMsSUFBSSxHQUFHLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsTUFBTSxFQUFFO2dCQUNuRixHQUFHLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEtBQUksQ0FBQyx1QkFBdUIsQ0FBQyxHQUFHLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7YUFDdkc7WUFDRCw0QkFDSyxHQUFHLElBQ04sZ0JBQWdCLEVBQUUsS0FBSyxJQUN2QjtRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELG1EQUFlLEdBQWY7UUFDRSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNuQyxPQUFPLENBQUMsSUFBSSxDQUFDLG9FQUFvRSxDQUFDLENBQUM7U0FDcEY7UUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUU7WUFDakMsK0ZBQStGO1lBQy9GLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixFQUFFO2dCQUNwQywyQ0FBMkM7Z0JBQzNDLE1BQU0sSUFBSSxLQUFLLENBQUMsa0pBQWtKLENBQUMsQ0FBQzthQUNySztTQUNGO0lBQ0gsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsMENBQU0sR0FBTixVQUFPLEdBQW1CO1FBQTFCLGlCQWFDO1FBWkMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFvQixFQUFFO1lBQ3BDLEdBQUcsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLENBQUMsZ0NBQWdDO1NBQ3hEO1FBQ0QsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUU7WUFDekUsT0FBTztTQUNSO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQUEsT0FBTyxJQUFJLE9BQUEsT0FBTyxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQS9ELENBQStELENBQUMsRUFBRTtZQUMvRixJQUFJLENBQUMsSUFBSSxvQkFBTyxJQUFJLENBQUMsSUFBSSxHQUFFLEdBQUcsRUFBQyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxRQUFRLENBQ1gsSUFBSSxDQUFDLElBQUksQ0FDVixDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILDZDQUFTLEdBQVQsVUFBVSxHQUFtQjtRQUE3QixpQkFVQztRQVRDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBQyxPQUFPLElBQUssT0FBQSxPQUFPLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBL0QsQ0FBK0QsQ0FBQyxDQUFDO1FBQzNHLG1FQUFtRTtRQUNuRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUMxQixJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQzVCO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FDWCxJQUFJLENBQUMsSUFBSSxDQUNWLENBQUM7SUFDSixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGlEQUFhLEdBQWIsVUFBYyxHQUFtQjtRQUFqQyxpQkFtQ0M7UUFsQ0MsNkRBQTZEO1FBQzdELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRTtZQUN0QyxzR0FBc0c7WUFDdEcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLE9BQU8sQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUEvRCxDQUErRCxDQUFDLEVBQUU7Z0JBQ2xILElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDNUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ2hCLElBQUksQ0FBQyxXQUFXLENBQUMscUJBQXFCLENBQ3BDLElBQUksQ0FBQyxRQUFRLEVBQ2IsR0FBRyxFQUNILElBQUksQ0FBQyxJQUFJLEVBQ1QsSUFBSSxDQUFDLE1BQU0sQ0FDWixDQUNGLENBQUM7YUFDSDtpQkFBTSxFQUFHLHlDQUF5QztnQkFDakQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDcEIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM3QixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUMzQjtTQUNGO2FBQU07WUFDTCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM1QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxxQkFBcUIsQ0FDcEMsSUFBSSxDQUFDLFFBQVEsRUFDYixHQUFHLEVBQ0gsSUFBSSxDQUFDLElBQUksRUFDVCxJQUFJLENBQUMsTUFBTSxDQUNaLENBQ0YsQ0FBQztTQUNIO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxzREFBa0IsR0FBbEIsVUFBbUIsR0FBbUIsRUFBRSxjQUFzQixFQUFFLFlBQW9CO1FBQXBGLGlCQTZCQztRQTdCdUMsK0JBQUEsRUFBQSxzQkFBc0I7UUFBRSw2QkFBQSxFQUFBLG9CQUFvQjtRQUNsRixHQUFHLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUN2QixJQUFJLENBQUMsY0FBYyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEVBQUU7WUFDekQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUU7Z0JBQzdFLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0RCxJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQzthQUNoRjtTQUNGO1FBQ0QsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3pELElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUM1QyxJQUFJLENBQUMsUUFBUSxFQUNiLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLEVBQ3BDLElBQUksQ0FBQyxNQUFNLENBQ1osQ0FBQztZQUNGLElBQUksU0FBUyxJQUFJLFNBQVMsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3JDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUN2RCxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLE9BQU87b0JBQ25ELHlDQUF5QztvQkFDekMsSUFBSSxPQUFPLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxHQUFHLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRTt3QkFDbEUsS0FBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFDckIsS0FBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7cUJBQzlDO2dCQUNILENBQUMsQ0FBQyxDQUFDO2FBQ0o7U0FDRjtRQUNELElBQUksQ0FBQyxRQUFRLENBQ1gsSUFBSSxDQUFDLElBQUksQ0FDVixDQUFDO0lBQ0osQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxtREFBZSxHQUFmLFVBQWdCLEdBQUc7UUFDakIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDMUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxxREFBaUIsR0FBakIsVUFBa0IsR0FBbUIsRUFBRSxjQUFzQixFQUFFLFlBQW9CO1FBQW5GLGlCQTRDQztRQTVDc0MsK0JBQUEsRUFBQSxzQkFBc0I7UUFBRSw2QkFBQSxFQUFBLG9CQUFvQjtRQUNqRixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQW9CLEVBQUU7WUFDcEMsR0FBRyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7U0FDdkI7UUFDRCxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDekQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUU7Z0JBQzdFLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRTtvQkFDbEMscURBQXFEO29CQUNyRCxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDdEQsOERBQThEO29CQUM5RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7aUJBQzVFO3FCQUFNO29CQUNMLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUNwRDthQUNGO1NBQ0Y7UUFDRCxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDekQsSUFBTSxXQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQzVDLElBQUksQ0FBQyxRQUFRLEVBQ2IsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsRUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FDWixDQUFDO1lBQ0YsSUFBSSxDQUFDLFdBQVMsRUFBRTtnQkFDZCxPQUFPO2FBQ1I7WUFDRCxJQUFNLGlCQUFpQixHQUFHLFdBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsTUFBTSxDQUFDO1lBQzFFLElBQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBQyxPQUFPO2dCQUNqRCx5Q0FBeUM7Z0JBQ3pDLE9BQU8sT0FBTyxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBSSxXQUFTLENBQUMsS0FBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN2RixDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDVixJQUNFLENBQUUsaUJBQWlCLEdBQUcsQ0FBQyxJQUFJLGlCQUFpQixHQUFHLENBQUMsQ0FBRTtnQkFDbEQsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUM7b0JBQ2xDLGlCQUFpQixLQUFLLFdBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQztvQkFDcEUsaUJBQWlCLEtBQUssaUJBQWlCLENBQ3hDLEVBQ0Q7Z0JBQ0EsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFTLENBQUMsQ0FBQztnQkFDdkIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDakQ7U0FDRjtRQUNELElBQUksQ0FBQyxRQUFRLENBQ1gsSUFBSSxDQUFDLElBQUksQ0FDVixDQUFDO0lBQ0osQ0FBQztJQUVELHFEQUFpQixHQUFqQixVQUFrQixFQUFPO1FBQ3ZCLDhDQUE4QztJQUNoRCxDQUFDO0lBRUQsaURBQWEsR0FBYixVQUFjLE1BQU07UUFBcEIsaUJBc0JDO1FBckJDLE1BQU0sQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1FBQ2xDLElBQ0UsQ0FBQyxJQUFJLENBQUMsY0FBYztZQUNwQixDQUNFLE1BQU0sQ0FBQyxHQUFHLEtBQUssU0FBUyxDQUFDLFFBQVE7Z0JBQ2pDLE1BQU0sQ0FBQyxHQUFHLEtBQUssU0FBUyxDQUFDLFVBQVUsQ0FDcEMsRUFDRDtZQUNBLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1NBQzVCO2FBQU0sSUFDTCxJQUFJLENBQUMsY0FBYztZQUNuQixNQUFNLENBQUMsR0FBRyxLQUFLLFNBQVMsQ0FBQyxNQUFNLEVBQy9CO1lBQ0EsT0FBTyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDNUI7UUFDRCxnQ0FBZ0M7UUFDaEMsVUFBVSxDQUFDO1lBQ1QsSUFBSSxLQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNqQixLQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUNuQztRQUNILENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNULENBQUM7O2dCQTVZdUIscUJBQXFCO2dCQUN0Qix1QkFBdUI7O0lBNUNHO1FBQWhELFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQzsrREFBNkI7SUFDcEU7UUFBUixLQUFLLEVBQUU7NkRBQWdDO0lBQy9CO1FBQVIsS0FBSyxFQUFFOytEQUEyQjtJQUMxQjtRQUFSLEtBQUssRUFBRTsrREFBa0I7SUFDakI7UUFBUixLQUFLLEVBQUU7a0VBQXNCO0lBQ3JCO1FBQVIsS0FBSyxFQUFFO3VFQUEyQztJQUMxQztRQUFSLEtBQUssRUFBRTtzRUFBMEM7SUFDekM7UUFBUixLQUFLLEVBQUU7K0RBQWtCO0lBQ2hCO1FBQVQsTUFBTSxFQUFFO2lFQUFpQztJQUNoQztRQUFULE1BQU0sRUFBRTsrREFBK0I7SUFDOUI7UUFBVCxNQUFNLEVBQUU7bUVBQW1DO0lBQ2xDO1FBQVQsTUFBTSxFQUFFO2tFQUFrQztJQUNLO1FBQS9DLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQzsrREFBNkI7SUFxQzVFO1FBREMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDOzZEQUdqQztJQXBEVSx5QkFBeUI7UUFWckMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLHVCQUF1QjtZQUNqQyx1K0RBQWtEO1lBRWxELFNBQVMsRUFBRTtnQkFDVCxnQ0FBZ0MsRUFBRTtnQkFDbEMscUNBQXFDLEVBQUU7YUFDeEM7WUFDRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7U0FDdEMsQ0FBQztPQUNXLHlCQUF5QixDQTBickM7SUFBRCxnQ0FBQztDQUFBLEFBMWJELElBMGJDO1NBMWJZLHlCQUF5QjtBQTZidEMsTUFBTSxVQUFVLGdDQUFnQztJQUM5QyxPQUFPO1FBQ0wsT0FBTyxFQUFFLGlCQUFpQjtRQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLGNBQU0sT0FBQSx5QkFBeUIsRUFBekIsQ0FBeUIsQ0FBQztRQUN4RCxLQUFLLEVBQUUsSUFBSTtLQUNaLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLHFDQUFxQztJQUNuRCxPQUFPO1FBQ0wsT0FBTyxFQUFFLGFBQWE7UUFDdEIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxjQUFNLE9BQUEseUJBQXlCLEVBQXpCLENBQXlCLENBQUM7UUFDeEQsS0FBSyxFQUFFLElBQUk7S0FDWixDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNjcm9sbFN0cmF0ZWd5LCBTY3JvbGxTdHJhdGVneU9wdGlvbnMgfSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheSc7XG5pbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgZm9yd2FyZFJlZixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBIb3N0TGlzdGVuZXIsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SLCBOR19WQUxJREFUT1JTLCBWYWxpZGF0b3IsIEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5pbXBvcnQgeyBBbmd1bGFyVGFnc0lucHV0U2VydmljZSB9IGZyb20gJy4vYW5ndWxhci10YWdzLWlucHV0LnNlcnZpY2UnO1xuaW1wb3J0IHsgVGFnSW5wdXRDb21wb25lbnQgfSBmcm9tICcuL3RhZy1pbnB1dC90YWctaW5wdXQuY29tcG9uZW50JztcbmltcG9ydCB7IEFuZ3VsYXJUYWdJdGVtLCBBbmd1bGFyVGFnc0lucHV0Q29uZmlnIH0gZnJvbSAnLi90YWdzLWlucHV0LWludGVyZmFjZXMnO1xuaW1wb3J0IHsgVW5BZGRlZFRhZ3NQaXBlIH0gZnJvbSAnLi91bi1hZGRlZC10YWdzLnBpcGUnO1xuaW1wb3J0IHsgRHJvcGRvd25Db21wb25lbnQgfSBmcm9tICcuL2Ryb3Bkb3duL2Ryb3Bkb3duLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBLRVlfQ09ERVMgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RpLWFuZ3VsYXItdGFncy1pbnB1dCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9hbmd1bGFyLXRhZ3MtaW5wdXQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9hbmd1bGFyLXRhZ3MtaW5wdXQuY29tcG9uZW50LnNjc3MnXSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgZ2V0QW5ndWxhclRhZ3NJbnB1dFZhbHVlQWNjZXNzb3IoKSxcbiAgICBnZXRBbmd1bGFyVGFnc0lucHV0VmFsaWRhdG9yc1Byb3ZpZGVyKClcbiAgXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBBbmd1bGFyVGFnc0lucHV0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25DaGFuZ2VzLCBWYWxpZGF0b3Ige1xuICBAVmlld0NoaWxkKERyb3Bkb3duQ29tcG9uZW50LCB7IHN0YXRpYzogZmFsc2UgfSkgZHJvcGRvd246IERyb3Bkb3duQ29tcG9uZW50O1xuICBASW5wdXQoKSBjb25maWc6IEFuZ3VsYXJUYWdzSW5wdXRDb25maWc7XG4gIEBJbnB1dCgpIHRhZ3NEYXRhOiBBcnJheTxhbnk+ID0gW107XG4gIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIHRhZ3NMb2FkaW5nOiBib29sZWFuO1xuICBASW5wdXQoKSBkcm9wRG93blRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+ID0gbnVsbDtcbiAgQElucHV0KCkgdGFnSXRlbVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+ID0gbnVsbDtcbiAgQElucHV0KCkgcmVxdWlyZWQgPSBmYWxzZTtcbiAgQE91dHB1dCgpIHRhZ1JlbW92ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSB0YWdBZGRlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGl0ZW1DbGlja2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAVmlld0NoaWxkKFRhZ0lucHV0Q29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSB0YWdJbnB1dDogVGFnSW5wdXRDb21wb25lbnQ7XG4gIHRhZ3M6IEFycmF5PEFuZ3VsYXJUYWdJdGVtPiA9IFtdO1xuICBpc0lucHV0Rm9jdXNlZDogYm9vbGVhbjtcbiAgaW5wdXRWYWw6IHN0cmluZztcbiAgZGVmYXVsdENvbmZpZzogQW5ndWxhclRhZ3NJbnB1dENvbmZpZyA9IHtcbiAgICBkZWZhdWx0Q2xhc3M6ICdhbmd1bGFyLXRhZ3MtaW5wdXQnLFxuICAgIGFkZGl0aW9uYWxDbGFzc2VzOiAnJyxcbiAgICBkaXNwbGF5UHJvcGVydHk6ICd2YWx1ZScsXG4gICAgaWRlbnRpZmllcjogJ2lkJyxcbiAgICBvbmx5RnJvbUF1dG9Db21wbGV0ZTogZmFsc2UsXG4gICAgcGxhY2Vob2xkZXI6ICdTZWFyY2gnLFxuICAgIGhpZGVBZGRlZFRhZ3M6IHRydWUsXG4gICAgbmVzdGVkVGFnUHJvcGVydHk6ICcnLFxuICAgIHNob3dUYWdzU2VsZWN0ZWRJbkREOiBmYWxzZSxcbiAgICBoaWRlVGFnczogZmFsc2UsXG4gICAgbWF4SXRlbXM6IG51bGwsXG4gICAgbmVzdGVkVGFnUGFyZW50UHJvcDogJycsXG4gICAga2V5Ym9hcmRBY3RpdmVDbGFzczogJ2FuZ3VsYXItdGFncy1kcm9wZG93bl9fbGlzdF9faXRlbS0tYWN0aXZlJ1xuICB9O1xuICBvbkNoYW5nZTogKGl0ZW1zOiBBbmd1bGFyVGFnSXRlbVtdKSA9PiB2b2lkO1xuICBkcm9wZG93bk92ZXJsYXlQb3NpdGlvbiA9IFtcbiAgICB7IG9mZnNldFk6IDEyLCBvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAnYm90dG9tJywgb3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAndG9wJyB9LFxuICAgIHsgb2Zmc2V0WTogLTI4LCBvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAndG9wJywgb3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAnYm90dG9tJyB9LFxuICAgIHsgb2Zmc2V0WTogMjgsIG9yaWdpblg6ICdlbmQnLCBvcmlnaW5ZOiAnYm90dG9tJywgb3ZlcmxheVg6ICdlbmQnLCBvdmVybGF5WTogJ2JvdHRvbScgfSxcbiAgICB7IG9mZnNldFk6IC0yOCwgb3JpZ2luWDogJ2VuZCcsIG9yaWdpblk6ICd0b3AnLCBvdmVybGF5WDogJ2VuZCcsIG92ZXJsYXlZOiAnYm90dG9tJyB9LFxuICBdO1xuICBkZFNjcm9sbFN0cmF0ZWd5OiBTY3JvbGxTdHJhdGVneTtcbiAgaXNEcm9wZG93bk9wZW46IGJvb2xlYW47XG4gIGRyb3Bkb3duU2hvd25ZZXQ6IGJvb2xlYW47XG4gIHVuQWRkZWRUYWdzUGlwZSA9IG5ldyBVbkFkZGVkVGFnc1BpcGUoKTtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBzc286IFNjcm9sbFN0cmF0ZWd5T3B0aW9ucyxcbiAgICBwcml2YXRlIHRhZ3NTZXJ2aWNlOiBBbmd1bGFyVGFnc0lucHV0U2VydmljZVxuICApIHsgfVxuXG5cbiAgQEhvc3RMaXN0ZW5lcigna2V5dXAnLCBbJyRldmVudCddKVxuICBrZXlFdmVudChldmVudCkge1xuICAgIHRoaXMuaW5wdXRLZXlQcmVzcyhldmVudCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgLy8gaWYgdGhlcmUncyBubyBjaGFuZ2UgaW4gdGhlIHRhZ3NEYXRhLCBkbyBub3RoaW5nXG4gICAgaWYgKCFjaGFuZ2VzLnRhZ3NEYXRhIHx8ICF0aGlzLmlzSW5wdXRGb2N1c2VkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIHByZXZpb3VzIHdhbHVlIHdhcyBgbnVsbGAgb3IgYHVuZGVmaW5lZGAsIHdlJ3JlIGluaXRpYWxpemluZyB0aGF0IGFzIGFuIGFycmF5IGhlcmVcbiAgICAvLyBzbyB3ZSBjYW4gYXZvaWQgYnJlYWtpbmcgdGhlIHByb2Nlc3MgZnVydGhlci5cbiAgICBpZiAoIWNoYW5nZXMudGFnc0RhdGEucHJldmlvdXNWYWx1ZSkge1xuICAgICAgY2hhbmdlcy50YWdzRGF0YS5wcmV2aW91c1ZhbHVlID0gW107XG4gICAgfVxuICAgIC8vIGlmIHdlIGhhdmUgdGhlIHZhbHVlIG9mIHRoZSB0YWdzIGNoYW5nZWQsIHdlIG5lZWQgdG8gc2hvdyB0aGUgZHJvcGRvd24gaW1tZWRpYXRlbHlcbiAgICAvLyB3ZSBkb24ndCBzaG93IHRoaXMgb24gdGhlIGZpcnN0IGNoYW5nZSwgYmVjYXVzZSB0aGF0J3Mgd2hlbiB0aGUgZmlyc3QgdmFsdWUgaXMgYXNzaWduZWRcbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzLnRhZ3NEYXRhICYmIGNoYW5nZXMudGFnc0RhdGEuY3VycmVudFZhbHVlICE9PSBjaGFuZ2VzLnRhZ3NEYXRhLnByZXZpb3VzVmFsdWVcbiAgICAgICYmICFjaGFuZ2VzLnRhZ3NEYXRhLmZpcnN0Q2hhbmdlXG4gICAgKSB7XG4gICAgICAvLyBpZiB0aGUgdmFsdWVzIGRvbid0IG1hdGNoLCBzaG93IHRoZSBkcm9wZG93blxuICAgICAgaWYgKGNoYW5nZXMudGFnc0RhdGEuY3VycmVudFZhbHVlLmxlbmd0aCAhPT0gY2hhbmdlcy50YWdzRGF0YS5wcmV2aW91c1ZhbHVlLmxlbmd0aCAmJiAhIXRoaXMuZHJvcGRvd25TaG93bllldCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93RHJvcGRvd24oY2hhbmdlcy50YWdzRGF0YS5jdXJyZW50VmFsdWUpO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2hhbmdlcy50YWdzRGF0YS5wcmV2aW91c1ZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8qIHNpbmNlIHRoZSB2YWx1ZXMgYXJlIGFycmF5LCB3ZSBuZWVkIHRvIGNvbXBhcmUgdGhlIGVsZW1lbnRzIHdpdGhpblxuICAgICAgICogYXZvaWRpbmcgdGhlIHVzYWdlIG9mIGFueSBleHRlcm5hbCBsaWJyYXJ5LCBtYXRjaGluZyB0aGUgZWxlbWVudHMgdXNpbmcgaWRlbnRpZmllclxuICAgICAgICogb2YgdGhlIGVsZW1lbnRzIGhlcmVcbiAgICAgICAqL1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNoYW5nZXMudGFnc0RhdGEuY3VycmVudFZhbHVlLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIGlmIChjaGFuZ2VzLnRhZ3NEYXRhLmN1cnJlbnRWYWx1ZVtpXVt0aGlzLmNvbmZpZy5pZGVudGlmaWVyXSAhPT0gY2hhbmdlcy50YWdzRGF0YS5wcmV2aW91c1ZhbHVlW2ldW3RoaXMuY29uZmlnLmlkZW50aWZpZXJdKSB7XG4gICAgICAgICAgLy8gYXMgc29vbiBhcyB0aGUgZGlmZmVyZW5jZSBpbiBlbGVtZW50cyBpcyBmb3VuZCwgc2hvdyB0aGUgZWxlbWVudCBhbmQgc3RvcCBmdXJ0aGVyIGV4ZWN1dGlvbiBvZiBmb3IgbG9vcFxuICAgICAgICAgIHJldHVybiB0aGlzLnNob3dEcm9wZG93bihjaGFuZ2VzLnRhZ3NEYXRhLmN1cnJlbnRWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvbkZvY3VzQ2hhbmdlKHZhbDogYm9vbGVhbikge1xuICAgIHRoaXMuaXNJbnB1dEZvY3VzZWQgPSB2YWw7XG4gICAgaWYgKCF2YWwgJiYgdGhpcy5jb25maWcuaGlkZURET25CbHVyKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24oKTtcbiAgICAgIH0sIDQwMCk7XG4gICAgfVxuICB9XG5cbiAgb25JbnB1dFZhbHVlQ2hhbmdlZCh2YWw6IHN0cmluZykge1xuICAgIHRoaXMuaW5wdXRWYWwgPSB2YWw7XG4gICAgdGhpcy52YWx1ZUNoYW5nZWQuZW1pdCh2YWwpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jb25maWcgPSB7IC8vIGFwcGx5aW5nIHRoZSBjb25maWd1cmF0aW9uIHByb3ZpZGVkXG4gICAgICAuLi50aGlzLmRlZmF1bHRDb25maWcsXG4gICAgICAuLi50aGlzLmNvbmZpZ1xuICAgIH07XG4gICAgdGhpcy5kZFNjcm9sbFN0cmF0ZWd5ID0gdGhpcy5zc28ucmVwb3NpdGlvbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBhdXRob3IgQWhzYW4gQXlhelxuICAgKiBAZGVzYyBUcmlnZ2VycyB3aGVuIHRoZSB2YWx1ZSBvZiB0aGUgZm9ybSBjb250cm9sIChvciBuZ01vZGVsKSBpcyBjaGFuZ2VkLlxuICAgKiBXZSdyZSB1c2luZyB0aGUgaGFuZGxlciB0byBhc3NpZ24gdGhlIHZhbHVlcyB0byB0aGUgdGFncyBhcnJheSB0aGF0IHdlIGhhdmUuXG4gICAqL1xuICB3cml0ZVZhbHVlKHRhZ3M6IEFycmF5PGFueT4pOiB2b2lkIHtcbiAgICB0YWdzID0gdGFncyA/IHRhZ3MgOiBbXTtcbiAgICB0YWdzID0gQXJyYXkuaXNBcnJheSh0YWdzKSA/IHRhZ3MgOiBbdGFnc107XG4gICAgdGhpcy50YWdzID0gdGFncy5tYXAoKHRhZykgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4udGFnLFxuICAgICAgICAuLi57XG4gICAgICAgICAgW3RoaXMuY29uZmlnLmlkZW50aWZpZXJdOiB0YWdbdGhpcy5jb25maWcuaWRlbnRpZmllcl0sXG4gICAgICAgICAgW3RoaXMuY29uZmlnLmRpc3BsYXlQcm9wZXJ0eV06IHRhZ1t0aGlzLmNvbmZpZy5kaXNwbGF5UHJvcGVydHldLFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuY29uZmlnLnNob3dUYWdzU2VsZWN0ZWRJbkREKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy50YWdzLm1hcCgodGFnKSA9PiB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RSZWxhdGVkVGFncyh0YWcpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICogQGRlc2MgUmVnaXN0ZXJzIHRoZSBvbiBjaGFuZ2UgZnVuY3Rpb24gdG8gdGhlIHZhbHVlIGFjY2Vzc29yXG4gICAqL1xuICByZWdpc3Rlck9uQ2hhbmdlKCBmbjogYW55ICk6IHZvaWQge1xuICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0b3IgZnVuY3Rpb24gZm9yIHRoZSBmb3JtIGNvbnRyb2xcbiAgICogRG9lc24ndCBkbyBhbnl0aGluZyBpZiB0aGUgY29udHJvbCBpcyBub3QgcmVxdWlyZWRcbiAgICogSWYgaXQgaXMgcmVxdWlyZWQsIGNoZWNrcyBpZiB0aGUgY29udHJvbCBjb250YWlucyB2YWx1ZVxuICAgKi9cbiAgdmFsaWRhdGUoY29udHJvbDogRm9ybUNvbnRyb2wpIHtcbiAgICBpZiAodGhpcy5yZXF1aXJlZCA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gKCEhY29udHJvbC52YWx1ZSAmJiBjb250cm9sLnZhbHVlLmxlbmd0aCkgPyBudWxsIDoge1xuICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICogQGRlc2MgVHJpZ2dlcnMgd2hlbiB0aGUgdGFnIGlucHV0IGlzIGZvY3VzZWRcbiAgICovXG4gIG9uSW5wdXRGb2N1cygpIHtcbiAgICBpZiAodGhpcy5jb25maWcuY2xlYXJJbnB1dE9uRm9jdXMpIHtcbiAgICAgIGlmICh0aGlzLnRhZ0lucHV0Lmxhc3RWYWx1ZUVtaXR0ZWQgIT09ICcnKSB7XG4gICAgICAgIHRoaXMudGFnSW5wdXQudGFnSW5wdXRGb3JtLmdldCgndGFnSW5wdXRWYWwnKS5zZXRWYWx1ZSgnJyk7XG4gICAgICB9XG4gICAgICB0aGlzLnRhZ0lucHV0LnJlc2V0SW5wdXQoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29uZmlnLmNsZWFyVGFnc09uRm9jdXMpIHtcbiAgICAgIHRoaXMudGFncy5sZW5ndGggPSAwO1xuICAgIH1cbiAgICB0aGlzLnNob3dEcm9wZG93bigpO1xuICAgIHRoaXMub25Gb2N1c0NoYW5nZSh0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICogQGRlc2MgU2hvd3MgdGhlIGRyb3Bkb3duIHdpdGggb3B0aW9ucyBsaXN0aW5nXG4gICAqL1xuICBzaG93RHJvcGRvd24ocmVjZW50VGFnczogQXJyYXk8YW55PiA9IG51bGwpIHtcbiAgICBjb25zdCB1bkFkZGVkVGFncyA9IHRoaXMudW5BZGRlZFRhZ3NQaXBlLnRyYW5zZm9ybShcbiAgICAgICEhcmVjZW50VGFncyA/IHJlY2VudFRhZ3MgOiB0aGlzLnRhZ3NEYXRhLFxuICAgICAge1xuICAgICAgICB0YWdzQWRkZWQ6IHRoaXMudGFncyxcbiAgICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZ1xuICAgICAgfVxuICAgICk7XG4gICAgaWYgKHVuQWRkZWRUYWdzLmxlbmd0aCkgeyAvLyBvbmx5IHNob3cgZHJvcGRvd24gd2hlbiB3ZSBoYXZlIGRhdGEgdG8gc2hvd1xuICAgICAgdGhpcy5pc0Ryb3Bkb3duT3BlbiA9IHRydWU7XG4gICAgfVxuICAgIGlmICghdGhpcy5kcm9wZG93blNob3duWWV0KSB7XG4gICAgICB0aGlzLmRyb3Bkb3duU2hvd25ZZXQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICogQGRlc2MgSGlkZXMgdGhlIG9wdGlvbnMgbGlzdGluZyBkcm9wZG93blxuICAgKi9cbiAgaGlkZURyb3Bkb3duKCkge1xuICAgIHRoaXMuaXNEcm9wZG93bk9wZW4gPSBmYWxzZTtcbiAgICB0aGlzLnRhZ3NEYXRhID0gdGhpcy5yZW1vdmVLZXlib2FyZFNlbGVjdGlvbih0aGlzLnRhZ3NEYXRhKTtcbiAgfVxuXG4gIHJlbW92ZUtleWJvYXJkU2VsZWN0aW9uKGl0ZW1zOiBBcnJheTxBbmd1bGFyVGFnSXRlbT4pIHtcbiAgICByZXR1cm4gaXRlbXMubWFwKCh0YWc6IEFuZ3VsYXJUYWdJdGVtKSA9PiB7XG4gICAgICBpZiAodGFnW3RoaXMuY29uZmlnLm5lc3RlZFRhZ1Byb3BlcnR5XSAmJiB0YWdbdGhpcy5jb25maWcubmVzdGVkVGFnUHJvcGVydHldLmxlbmd0aCkge1xuICAgICAgICB0YWdbdGhpcy5jb25maWcubmVzdGVkVGFnUHJvcGVydHldID0gdGhpcy5yZW1vdmVLZXlib2FyZFNlbGVjdGlvbih0YWdbdGhpcy5jb25maWcubmVzdGVkVGFnUHJvcGVydHldKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnRhZyxcbiAgICAgICAgdGlLZXlib2FyZEFjdGl2ZTogZmFsc2VcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgaWYgKCEhdGhpcy5jb25maWcgfHwgIXRoaXMub25DaGFuZ2UpIHtcbiAgICAgIGNvbnNvbGUud2FybignUGxlYXNlIHVzZSBuZ01vZGVsIG9yIEZvcm1Db250cm9sTmFtZSB3aXRoIDx0aS1hbmd1bGFyLXRhZ3MtaW5wdXQ+Jyk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eSkge1xuICAgICAgLy8gd2UgbmVlZCB0aGUgcGFyZW50IHByb3BlcnR5IHRvIGJlIGFibGUgdG8gdW5zZWxlY3QgdGhlIHBhcmVudCB3aGVuIGEgY2hpbGQgdGFnIGlzIHVuc2VsZWN0ZWRcbiAgICAgIGlmICghdGhpcy5jb25maWcubmVzdGVkVGFnUGFyZW50UHJvcCkge1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignbmVzdGVkVGFnUHJvcGVydHkgcHJvdmlkZWQgYnV0IG5lc3RlZFRhZ1BhcmVudFByb3Agbm90IHByb3ZpZGVkLlxcblRoaXMgd2lsbCBjYXVzZSB0aGUgcGFyZW50IHRhZyB0byBub3QgcmVtb3ZlIGlmIGFueSBvZiB0aGUgY2hpbGRyZW4gaXMgcmVtb3ZlZCcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICogQGRlc2MgQWRkcyB0aGUgdGFnIGluIHRoZSB0YWdzIGxpc3QgKHRhZ3MgYXJyYXkpLlxuICAgKiBBdm9pZHMgZHVwbGljYXRlIHRhZ3MgYWRkaXRpb25cbiAgICogQHBhcmFtIHRhZyAtIHRhZyB0byBhZGRcbiAgICovXG4gIGFkZFRhZyh0YWc6IEFuZ3VsYXJUYWdJdGVtKSB7XG4gICAgaWYgKHRoaXMuY29uZmlnLnNob3dUYWdzU2VsZWN0ZWRJbkREKSB7XG4gICAgICB0YWcudGlTZWxlY3RlZCA9IHRydWU7IC8vIG1hcmtzIHRoZSBlbGVtZW50IGFzIHNlbGVjdGVkXG4gICAgfVxuICAgIGlmICh0aGlzLmNvbmZpZy5tYXhJdGVtcyA+IDAgJiYgdGhpcy50YWdzLmxlbmd0aCA9PT0gdGhpcy5jb25maWcubWF4SXRlbXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnRhZ3MuZmluZCh0YWdJdGVtID0+IHRhZ0l0ZW1bdGhpcy5jb25maWcuaWRlbnRpZmllcl0gPT09IHRhZ1t0aGlzLmNvbmZpZy5pZGVudGlmaWVyXSkpIHtcbiAgICAgIHRoaXMudGFncyA9IFsuLi50aGlzLnRhZ3MsIHRhZ107XG4gICAgICB0aGlzLm9uQ2hhbmdlKFxuICAgICAgICB0aGlzLnRhZ3NcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBhdXRob3IgQWhzYW4gQXlhelxuICAgKiBAZGVzYyBSZW1vdmVzIHRoZSB0YWdzIGZyb20gdGhlIHRhZ3MgbGlzdFxuICAgKiBAcGFyYW0gdGFnIC0gdGFnIHRvIHJlbW92ZVxuICAgKi9cbiAgcmVtb3ZlVGFnKHRhZzogQW5ndWxhclRhZ0l0ZW0pIHtcbiAgICB0aGlzLnRhZ3MgPSB0aGlzLnRhZ3MuZmlsdGVyKCh0YWdJdGVtKSA9PiB0YWdJdGVtW3RoaXMuY29uZmlnLmlkZW50aWZpZXJdICE9PSB0YWdbdGhpcy5jb25maWcuaWRlbnRpZmllcl0pO1xuICAgIC8vIHdoZW4gd2UndmUgcmVtb3ZlZCBhbGwgdGhlIHRhZ3MsIHdlIHdhbnQgdG8gZ2V0IHRoZSBkZWZhdWx0IHRhZ3NcbiAgICBpZiAodGhpcy50YWdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy50YWdJbnB1dC5yZXNldElucHV0KCk7XG4gICAgICB0aGlzLnZhbHVlQ2hhbmdlZC5lbWl0KCcnKTtcbiAgICB9XG4gICAgdGhpcy5vbkNoYW5nZShcbiAgICAgIHRoaXMudGFnc1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQGF1dGhvciBBaHNhbiBBeWF6XG4gICAqIEBkZXNjIFRyaWdnZXJzIHdoZW4gdGhlIGl0ZW0gaXMgY2xpY2tlZCBmcm9tIHRoZSBkcm9wZG93blxuICAgKiBAcGFyYW0gdGFnIC0gdGFnIHNlbGVjdGVkXG4gICAqL1xuICBvbkl0ZW1DbGlja2VkKHRhZzogQW5ndWxhclRhZ0l0ZW0pIHtcbiAgICAvLyBpZiB3ZSBkb24ndCBoYXZlIHRvIHRvZ2dsZSwgYWRkIHRoZSBpdGVtIGFzIHRhZyByaWdodCBhd2F5XG4gICAgaWYgKHRoaXMuY29uZmlnLnRvZ2dsZVNlbGVjdGlvbk9uQ2xpY2spIHtcbiAgICAgIC8vIHdlIGhhdmUgdG8gdG9nZ2xlIHNlbGVjdGlvbi4gRmlyc3QsIGxldCdzIHNlZSBpZiB0aGUgdGFnIGRvZXNuJ3QgZXhpc3QgYWxyZWFkeSBpbiB0aGUgc2VsZWN0ZWQgdGFnc1xuICAgICAgaWYgKCF0YWcudGlTZWxlY3RlZCAmJiAhdGhpcy50YWdzLmZpbmQodGFnSXRlbSA9PiB0YWdJdGVtW3RoaXMuY29uZmlnLmlkZW50aWZpZXJdID09PSB0YWdbdGhpcy5jb25maWcuaWRlbnRpZmllcl0pKSB7XG4gICAgICAgIHRoaXMuYWRkVGFnKHRhZyk7XG4gICAgICAgIHRoaXMuc2VsZWN0UmVsYXRlZFRhZ3ModGFnKTtcbiAgICAgICAgdGhpcy50YWdBZGRlZC5lbWl0KFxuICAgICAgICAgIHRoaXMudGFnc1NlcnZpY2UuZ2V0TWFpblRhZ0FmdGVyQWRkaW5nKFxuICAgICAgICAgICAgdGhpcy50YWdzRGF0YSxcbiAgICAgICAgICAgIHRhZyxcbiAgICAgICAgICAgIHRoaXMudGFncyxcbiAgICAgICAgICAgIHRoaXMuY29uZmlnXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHsgIC8vIGlmIHRoZSB0YWcgaXMgYWxyZWFkeSBzZWxlY3RlZCwgcmVtb3ZlXG4gICAgICAgIHRoaXMucmVtb3ZlVGFnKHRhZyk7XG4gICAgICAgIHRoaXMucmVtb3ZlVGFnU2VsZWN0aW9uKHRhZyk7XG4gICAgICAgIHRoaXMudGFnUmVtb3ZlZC5lbWl0KHRhZyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWRkVGFnKHRhZyk7XG4gICAgICB0aGlzLnNlbGVjdFJlbGF0ZWRUYWdzKHRhZyk7XG4gICAgICB0aGlzLnRhZ0FkZGVkLmVtaXQoXG4gICAgICAgIHRoaXMudGFnc1NlcnZpY2UuZ2V0TWFpblRhZ0FmdGVyQWRkaW5nKFxuICAgICAgICAgIHRoaXMudGFnc0RhdGEsXG4gICAgICAgICAgdGFnLFxuICAgICAgICAgIHRoaXMudGFncyxcbiAgICAgICAgICB0aGlzLmNvbmZpZ1xuICAgICAgICApXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLnRhZ0lucHV0LnJlc2V0SW5wdXQoKTtcbiAgICB0aGlzLml0ZW1DbGlja2VkLmVtaXQodGFnKTtcbiAgICB0aGlzLmhpZGVEcm9wZG93bigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBhdXRob3IgQWhzYW4gQXlhelxuICAgKiBAZGVzYyBSZW1vdmVzIHRoZSB0YWcgc2VsZWNlZCBzdGF0ZSAoYW5kIG9mIHRoZSBjaGlsZHJlbilcbiAgICogQHBhcmFtIHRhZyAtIHRoZSB0YWcgdG8gdW5tYXJrIGFzIHNlbGVjdGVkXG4gICAqL1xuICByZW1vdmVUYWdTZWxlY3Rpb24odGFnOiBBbmd1bGFyVGFnSXRlbSwgaWdub3JlQ2hpbGRyZW4gPSBmYWxzZSwgaWdub3JlUGFyZW50ID0gZmFsc2UpIHtcbiAgICB0YWcudGlTZWxlY3RlZCA9IGZhbHNlO1xuICAgIGlmICghaWdub3JlQ2hpbGRyZW4gJiYgdGFnW3RoaXMuY29uZmlnLm5lc3RlZFRhZ1Byb3BlcnR5XSkge1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRhZ1t0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eV0ubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVUYWcodGFnW3RoaXMuY29uZmlnLm5lc3RlZFRhZ1Byb3BlcnR5XVtpXSk7XG4gICAgICAgIHRoaXMucmVtb3ZlVGFnU2VsZWN0aW9uKHRhZ1t0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eV1baV0sIGlnbm9yZUNoaWxkcmVuKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRhZ1t0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQYXJlbnRQcm9wXSAmJiAhaWdub3JlUGFyZW50KSB7XG4gICAgICBjb25zdCBwYXJlbnRUYWcgPSB0aGlzLnRhZ3NTZXJ2aWNlLmZpbmRUYWdCeUlkKFxuICAgICAgICB0aGlzLnRhZ3NEYXRhLFxuICAgICAgICB0YWdbdGhpcy5jb25maWcubmVzdGVkVGFnUGFyZW50UHJvcF0sXG4gICAgICAgIHRoaXMuY29uZmlnXG4gICAgICApO1xuICAgICAgaWYgKHBhcmVudFRhZyAmJiBwYXJlbnRUYWcudGlTZWxlY3RlZCkge1xuICAgICAgICB0aGlzLnJlbW92ZVRhZyhwYXJlbnRUYWcpO1xuICAgICAgICB0aGlzLnJlbW92ZVRhZ1NlbGVjdGlvbihwYXJlbnRUYWcsIHRydWUsIGlnbm9yZVBhcmVudCk7XG4gICAgICAgIHBhcmVudFRhZ1t0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eV0ubWFwKCh0YWdJdGVtKSA9PiB7XG4gICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnRyaXBsZS1lcXVhbHNcbiAgICAgICAgICBpZiAodGFnSXRlbVt0aGlzLmNvbmZpZy5pZGVudGlmaWVyXSAhPSB0YWdbdGhpcy5jb25maWcuaWRlbnRpZmllcl0pIHtcbiAgICAgICAgICAgIHRoaXMuYWRkVGFnKHRhZ0l0ZW0pO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RSZWxhdGVkVGFncyh0YWdJdGVtLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5vbkNoYW5nZShcbiAgICAgIHRoaXMudGFnc1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQGF1dGhvciBBaHNhbiBBeWF6XG4gICAqIEBkZXNjIHRyaWdnZXJzIG9uIGNsb3NlIGJ1dHRvbiBjbGljayBvZiB0aGUgdGFnc1xuICAgKiBAcGFyYW0gdGFnIC0gdGhlIHRhZyB0byByZW1vdmVcbiAgICovXG4gIHRhZ0Nsb3NlQ2xpY2tlZCh0YWcpIHtcbiAgICB0aGlzLnRhZ1JlbW92ZWQuZW1pdCh0YWcpO1xuICAgIHRoaXMucmVtb3ZlVGFnKHRhZyk7XG4gICAgdGhpcy5yZW1vdmVUYWdTZWxlY3Rpb24odGFnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAYXV0aG9yIEFoc2FuIEF5YXpcbiAgICogQGRlc2MgU2VsZWN0cy9hZGRzIHRoZSByZXRhdGVkIHRhZ3MgKHBhcmVudCBhbmQvb3IgY2hpbGRyZW4pXG4gICAqIEBwYXJhbSB0YWcgLSB0aGUgdGFnIHRvIG1hcmsgYXMgc2VsZWN0ZWRcbiAgICovXG4gIHNlbGVjdFJlbGF0ZWRUYWdzKHRhZzogQW5ndWxhclRhZ0l0ZW0sIGlnbm9yZUNoaWxkcmVuID0gZmFsc2UsIGlnbm9yZVBhcmVudCA9IGZhbHNlKSB7XG4gICAgaWYgKHRoaXMuY29uZmlnLnNob3dUYWdzU2VsZWN0ZWRJbkREKSB7XG4gICAgICB0YWcudGlTZWxlY3RlZCA9IHRydWU7XG4gICAgfVxuICAgIGlmICh0YWdbdGhpcy5jb25maWcubmVzdGVkVGFnUHJvcGVydHldICYmICFpZ25vcmVDaGlsZHJlbikge1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRhZ1t0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eV0ubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnNob3dQYXJlbnRUYWdzT25seSkge1xuICAgICAgICAgIC8vIHJlbW92ZSB0aGUgY2hpbGRyZW4gaWYgd2Ugb25seSBoYXZlIHRvIGtlZXAgcGFyZW50XG4gICAgICAgICAgdGhpcy5yZW1vdmVUYWcodGFnW3RoaXMuY29uZmlnLm5lc3RlZFRhZ1Byb3BlcnR5XVtpXSk7XG4gICAgICAgICAgLy8gbWFraW5nIHN1cmUgd2UncmUgdGFyZ2V0aW5nIG9ubHkgY2hpbGRyZW4sIGlnbm9yaW5nIHBhcmVudHNcbiAgICAgICAgICB0aGlzLnNlbGVjdFJlbGF0ZWRUYWdzKHRhZ1t0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eV1baV0sIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmFkZFRhZyh0YWdbdGhpcy5jb25maWcubmVzdGVkVGFnUHJvcGVydHldW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGFnW3RoaXMuY29uZmlnLm5lc3RlZFRhZ1BhcmVudFByb3BdICYmICFpZ25vcmVQYXJlbnQpIHtcbiAgICAgIGNvbnN0IHBhcmVudFRhZyA9IHRoaXMudGFnc1NlcnZpY2UuZmluZFRhZ0J5SWQoXG4gICAgICAgIHRoaXMudGFnc0RhdGEsXG4gICAgICAgIHRhZ1t0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQYXJlbnRQcm9wXSxcbiAgICAgICAgdGhpcy5jb25maWdcbiAgICAgICk7XG4gICAgICBpZiAoIXBhcmVudFRhZykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBwYXJlbnRUYWdDaGlsZHJlbiA9IHBhcmVudFRhZ1t0aGlzLmNvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eV0ubGVuZ3RoO1xuICAgICAgY29uc3QgY2hpbGRyZW5zU2VsZWN0ZWQgPSB0aGlzLnRhZ3MuZmlsdGVyKCh0YWdJdGVtKSA9PiB7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp0cmlwbGUtZXF1YWxzXG4gICAgICAgIHJldHVybiB0YWdJdGVtW3RoaXMuY29uZmlnLm5lc3RlZFRhZ1BhcmVudFByb3BdID09IHBhcmVudFRhZ1t0aGlzLmNvbmZpZy5pZGVudGlmaWVyXTtcbiAgICAgIH0pLmxlbmd0aDtcbiAgICAgIGlmIChcbiAgICAgICAgKCBwYXJlbnRUYWdDaGlsZHJlbiA+IDAgJiYgY2hpbGRyZW5zU2VsZWN0ZWQgPiAwICkgJiZcbiAgICAgICAgKHRoaXMuY29uZmlnLmNoaWxkcmVuQ291bnRQcm9wZXJ0eSA/XG4gICAgICAgICAgY2hpbGRyZW5zU2VsZWN0ZWQgPT09IHBhcmVudFRhZ1t0aGlzLmNvbmZpZy5jaGlsZHJlbkNvdW50UHJvcGVydHldIDpcbiAgICAgICAgICBjaGlsZHJlbnNTZWxlY3RlZCA9PT0gcGFyZW50VGFnQ2hpbGRyZW5cbiAgICAgICAgKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuYWRkVGFnKHBhcmVudFRhZyk7XG4gICAgICAgIHRoaXMuc2VsZWN0UmVsYXRlZFRhZ3MocGFyZW50VGFnLCBmYWxzZSwgZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm9uQ2hhbmdlKFxuICAgICAgdGhpcy50YWdzXG4gICAgKTtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcbiAgICAvLyB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgfVxuXG4gIGlucHV0S2V5UHJlc3MoJGV2ZW50KSB7XG4gICAgJGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgIGlmIChcbiAgICAgICF0aGlzLmlzRHJvcGRvd25PcGVuICYmXG4gICAgICAoXG4gICAgICAgICRldmVudC5rZXkgPT09IEtFWV9DT0RFUy5BUlJPV19VUCB8fFxuICAgICAgICAkZXZlbnQua2V5ID09PSBLRVlfQ09ERVMuQVJST1dfRE9XTlxuICAgICAgKVxuICAgICkge1xuICAgICAgdGhpcy5pc0Ryb3Bkb3duT3BlbiA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHRoaXMuaXNEcm9wZG93bk9wZW4gJiZcbiAgICAgICRldmVudC5rZXkgPT09IEtFWV9DT0RFUy5FU0NBUEVcbiAgICApIHtcbiAgICAgIHJldHVybiB0aGlzLmhpZGVEcm9wZG93bigpO1xuICAgIH1cbiAgICAvLyBzbyB3ZSBoYXZlIHRoZSBkcm9wZG93biBzaG93blxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuZHJvcGRvd24pIHtcbiAgICAgICAgdGhpcy5kcm9wZG93bi5oYW5kbGVLZXlVcCgkZXZlbnQpO1xuICAgICAgfVxuICAgIH0sIDEwKTtcbiAgfVxuXG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEFuZ3VsYXJUYWdzSW5wdXRWYWx1ZUFjY2Vzc29yKCkge1xuICByZXR1cm4ge1xuICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEFuZ3VsYXJUYWdzSW5wdXRDb21wb25lbnQpLFxuICAgIG11bHRpOiB0cnVlLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QW5ndWxhclRhZ3NJbnB1dFZhbGlkYXRvcnNQcm92aWRlcigpIHtcbiAgcmV0dXJuIHtcbiAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxuICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEFuZ3VsYXJUYWdzSW5wdXRDb21wb25lbnQpLFxuICAgIG11bHRpOiB0cnVlLFxuICB9O1xufVxuIl19