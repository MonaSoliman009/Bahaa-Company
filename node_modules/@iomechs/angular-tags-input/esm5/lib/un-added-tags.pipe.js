import * as tslib_1 from "tslib";
import { Pipe } from '@angular/core';
var UnAddedTagsPipe = /** @class */ (function () {
    function UnAddedTagsPipe() {
    }
    UnAddedTagsPipe.prototype.transform = function (tagsList, args) {
        var _this = this;
        var result = [];
        var tagsAdded = args.tagsAdded, config = args.config;
        // if the tagsList is falsy, return empty list
        if (!tagsList) {
            return [];
        }
        // if we have to show selected tags (adds selected: true to every item (or nested tag))
        if (config.showTagsSelectedInDD) {
            tagsList = this.setSelectedTags(tagsList, config, tagsAdded);
        }
        // if we don't have to hide tags, send the tagsList (final, processed) back
        if (!config.hideAddedTags) {
            return tagsList;
        }
        /**
         * if we have to filter out the already selected tags in the dropdown, we'll filter these out
         * and thus the already selected tags won't go back in the results for dropdown
         */
        for (var i = 0, len = tagsList.length; i < len; ++i) {
            var currentTagItem = tslib_1.__assign({}, tagsList[i]); // making sure we're not modifying the original object here
            if (!this.isTagAlreadySelected(currentTagItem, tagsAdded, config)) { // if the tag to add isn't added already
                currentTagItem.tiSelected = false;
                if (config.nestedTagProperty && currentTagItem[config.nestedTagProperty]) {
                    currentTagItem[config.nestedTagProperty] = currentTagItem[config.nestedTagProperty].filter(function (tagItem) {
                        return !_this.isTagAlreadySelected(tagItem, tagsAdded, config);
                    });
                }
                result.push(currentTagItem);
            }
        }
        return result;
    };
    /**
     * @author Ahsan Ayaz
     * @desc Compares a tag against all the tags added based on config provided
     * @param currentTag - the tag to check if it exists in the selection
     * @param tagsAdded - an array of the tags added to the selection
     * @param config - the config provided to the Angular Tags Input component
     * @return boolean - if the tag is added already
     */
    UnAddedTagsPipe.prototype.isTagAlreadySelected = function (currentTag, tagsAdded, config) {
        var _this = this;
        return tagsAdded.find(function (tagItem) {
            var matchFound = false;
            matchFound = _this.areTagsMatching(currentTag, tagItem, config);
            if (matchFound) {
                return true;
            }
            else if (tagItem[config.nestedTagProperty]) {
                return _this.isTagAlreadySelected(currentTag, tagItem[config.nestedTagProperty], config);
            }
            return false;
        });
    };
    /**
     * @author Ahsan Ayaz
     * @desc Compares the two tags based on the identifier provided in the config
     * @param currentTag - the tag in the iteration to compare
     * @param tagItem - the tag (already selected) to compare with
     * @param config - the config provided to the Angular Tags Input component
     * @return boolean - if the tags passed are the same.
     */
    UnAddedTagsPipe.prototype.areTagsMatching = function (currentTag, tagItem, config) {
        if (typeof tagItem[config.identifier] === 'number') {
            // handling if the type of identifier is a number
            return tagItem[config.identifier] === +currentTag[config.identifier];
        }
        else if (typeof tagItem[config.identifier] === 'string' && typeof currentTag[config.identifier] === 'string') {
            // handling if the type of identifier is a string
            return tagItem[config.identifier].toLowerCase() === currentTag[config.identifier].toLowerCase();
        }
    };
    UnAddedTagsPipe.prototype.setSelectedTags = function (tags, config, tagsAdded, isSelected) {
        var _this = this;
        if (isSelected === void 0) { isSelected = null; }
        return tags.map(function (currentTag) {
            currentTag.tiSelected = !!_this.isTagAlreadySelected(currentTag, tagsAdded, config);
            if (config.showTagsSelectedInDD && !!isSelected) {
                currentTag.tiSelected = true;
            }
            if (currentTag[config.nestedTagProperty] && currentTag[config.nestedTagProperty].length) {
                currentTag[config.nestedTagProperty] = _this.setSelectedTags(currentTag[config.nestedTagProperty], config, tagsAdded, currentTag.tiSelected);
            }
            return currentTag;
        });
    };
    UnAddedTagsPipe = tslib_1.__decorate([
        Pipe({
            name: 'unAddedTags'
        })
    ], UnAddedTagsPipe);
    return UnAddedTagsPipe;
}());
export { UnAddedTagsPipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW4tYWRkZWQtdGFncy5waXBlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGlvbWVjaHMvYW5ndWxhci10YWdzLWlucHV0LyIsInNvdXJjZXMiOlsibGliL3VuLWFkZGVkLXRhZ3MucGlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFPcEQ7SUFBQTtJQWdHQSxDQUFDO0lBL0ZDLG1DQUFTLEdBQVQsVUFBVSxRQUFvQixFQUFFLElBQTZEO1FBQTdGLGlCQW9DQztRQW5DQyxJQUFNLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDWCxJQUFBLDBCQUFTLEVBQUUsb0JBQU0sQ0FBUztRQUVqQyw4Q0FBOEM7UUFDOUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNiLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFFRCx1RkFBdUY7UUFDdkYsSUFBSSxNQUFNLENBQUMsb0JBQW9CLEVBQUU7WUFDL0IsUUFBUSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztTQUM5RDtRQUVELDJFQUEyRTtRQUMzRSxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRTtZQUN6QixPQUFPLFFBQVEsQ0FBQztTQUNqQjtRQUVEOzs7V0FHRztRQUNILEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDbkQsSUFBTSxjQUFjLHdCQUFPLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUUsMkRBQTJEO1lBQ3JHLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsY0FBYyxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsRUFBRSxFQUFFLHdDQUF3QztnQkFDM0csY0FBYyxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7Z0JBQ2xD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QUMsaUJBQWlCLENBQUMsRUFDcEMsTUFBTSxFQUNOLFNBQVMsRUFDVCxVQUFVLENBQUMsVUFBVSxDQUN0QixDQUFDO2FBQ0g7WUFDRCxPQUFPLFVBQVUsQ0FBQztRQUNwQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUE5RlUsZUFBZTtRQUgzQixJQUFJLENBQUM7WUFDSixJQUFJLEVBQUUsYUFBYTtTQUNwQixDQUFDO09BQ1csZUFBZSxDQWdHM0I7SUFBRCxzQkFBQztDQUFBLEFBaEdELElBZ0dDO1NBaEdZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQaXBlLCBQaXBlVHJhbnNmb3JtIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IEFuZ3VsYXJUYWdzSW5wdXRDb25maWcgfSBmcm9tICcuL3RhZ3MtaW5wdXQtaW50ZXJmYWNlcyc7XG5cbkBQaXBlKHtcbiAgbmFtZTogJ3VuQWRkZWRUYWdzJ1xufSlcbmV4cG9ydCBjbGFzcyBVbkFkZGVkVGFnc1BpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcbiAgdHJhbnNmb3JtKHRhZ3NMaXN0OiBBcnJheTxhbnk+LCBhcmdzOiB7dGFnc0FkZGVkOiBBcnJheTxhbnk+LCBjb25maWc6IEFuZ3VsYXJUYWdzSW5wdXRDb25maWd9KTogYW55IHtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBjb25zdCB7dGFnc0FkZGVkLCBjb25maWd9ID0gYXJncztcblxuICAgIC8vIGlmIHRoZSB0YWdzTGlzdCBpcyBmYWxzeSwgcmV0dXJuIGVtcHR5IGxpc3RcbiAgICBpZiAoIXRhZ3NMaXN0KSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgaGF2ZSB0byBzaG93IHNlbGVjdGVkIHRhZ3MgKGFkZHMgc2VsZWN0ZWQ6IHRydWUgdG8gZXZlcnkgaXRlbSAob3IgbmVzdGVkIHRhZykpXG4gICAgaWYgKGNvbmZpZy5zaG93VGFnc1NlbGVjdGVkSW5ERCkge1xuICAgICAgdGFnc0xpc3QgPSB0aGlzLnNldFNlbGVjdGVkVGFncyh0YWdzTGlzdCwgY29uZmlnLCB0YWdzQWRkZWQpO1xuICAgIH1cblxuICAgIC8vIGlmIHdlIGRvbid0IGhhdmUgdG8gaGlkZSB0YWdzLCBzZW5kIHRoZSB0YWdzTGlzdCAoZmluYWwsIHByb2Nlc3NlZCkgYmFja1xuICAgIGlmICghY29uZmlnLmhpZGVBZGRlZFRhZ3MpIHtcbiAgICAgIHJldHVybiB0YWdzTGlzdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBpZiB3ZSBoYXZlIHRvIGZpbHRlciBvdXQgdGhlIGFscmVhZHkgc2VsZWN0ZWQgdGFncyBpbiB0aGUgZHJvcGRvd24sIHdlJ2xsIGZpbHRlciB0aGVzZSBvdXRcbiAgICAgKiBhbmQgdGh1cyB0aGUgYWxyZWFkeSBzZWxlY3RlZCB0YWdzIHdvbid0IGdvIGJhY2sgaW4gdGhlIHJlc3VsdHMgZm9yIGRyb3Bkb3duXG4gICAgICovXG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRhZ3NMaXN0Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICBjb25zdCBjdXJyZW50VGFnSXRlbSA9IHsuLi50YWdzTGlzdFtpXX07ICAvLyBtYWtpbmcgc3VyZSB3ZSdyZSBub3QgbW9kaWZ5aW5nIHRoZSBvcmlnaW5hbCBvYmplY3QgaGVyZVxuICAgICAgaWYgKCF0aGlzLmlzVGFnQWxyZWFkeVNlbGVjdGVkKGN1cnJlbnRUYWdJdGVtLCB0YWdzQWRkZWQsIGNvbmZpZykpIHsgLy8gaWYgdGhlIHRhZyB0byBhZGQgaXNuJ3QgYWRkZWQgYWxyZWFkeVxuICAgICAgICBjdXJyZW50VGFnSXRlbS50aVNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIGlmIChjb25maWcubmVzdGVkVGFnUHJvcGVydHkgJiYgY3VycmVudFRhZ0l0ZW1bY29uZmlnLm5lc3RlZFRhZ1Byb3BlcnR5XSkge1xuICAgICAgICAgIGN1cnJlbnRUYWdJdGVtW2NvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eV0gPSBjdXJyZW50VGFnSXRlbVtjb25maWcubmVzdGVkVGFnUHJvcGVydHldLmZpbHRlcigodGFnSXRlbSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlzVGFnQWxyZWFkeVNlbGVjdGVkKHRhZ0l0ZW0sIHRhZ3NBZGRlZCwgY29uZmlnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQucHVzaChjdXJyZW50VGFnSXRlbSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQGF1dGhvciBBaHNhbiBBeWF6XG4gICAqIEBkZXNjIENvbXBhcmVzIGEgdGFnIGFnYWluc3QgYWxsIHRoZSB0YWdzIGFkZGVkIGJhc2VkIG9uIGNvbmZpZyBwcm92aWRlZFxuICAgKiBAcGFyYW0gY3VycmVudFRhZyAtIHRoZSB0YWcgdG8gY2hlY2sgaWYgaXQgZXhpc3RzIGluIHRoZSBzZWxlY3Rpb25cbiAgICogQHBhcmFtIHRhZ3NBZGRlZCAtIGFuIGFycmF5IG9mIHRoZSB0YWdzIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb25cbiAgICogQHBhcmFtIGNvbmZpZyAtIHRoZSBjb25maWcgcHJvdmlkZWQgdG8gdGhlIEFuZ3VsYXIgVGFncyBJbnB1dCBjb21wb25lbnRcbiAgICogQHJldHVybiBib29sZWFuIC0gaWYgdGhlIHRhZyBpcyBhZGRlZCBhbHJlYWR5XG4gICAqL1xuICBpc1RhZ0FscmVhZHlTZWxlY3RlZChjdXJyZW50VGFnLCB0YWdzQWRkZWQsIGNvbmZpZzogQW5ndWxhclRhZ3NJbnB1dENvbmZpZykge1xuICAgIHJldHVybiB0YWdzQWRkZWQuZmluZCh0YWdJdGVtID0+IHtcbiAgICAgIGxldCBtYXRjaEZvdW5kID0gZmFsc2U7XG4gICAgICBtYXRjaEZvdW5kID0gdGhpcy5hcmVUYWdzTWF0Y2hpbmcoY3VycmVudFRhZywgdGFnSXRlbSwgY29uZmlnKTtcbiAgICAgIGlmIChtYXRjaEZvdW5kKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmICh0YWdJdGVtW2NvbmZpZy5uZXN0ZWRUYWdQcm9wZXJ0eV0pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNUYWdBbHJlYWR5U2VsZWN0ZWQoY3VycmVudFRhZywgdGFnSXRlbVtjb25maWcubmVzdGVkVGFnUHJvcGVydHldLCBjb25maWcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBhdXRob3IgQWhzYW4gQXlhelxuICAgKiBAZGVzYyBDb21wYXJlcyB0aGUgdHdvIHRhZ3MgYmFzZWQgb24gdGhlIGlkZW50aWZpZXIgcHJvdmlkZWQgaW4gdGhlIGNvbmZpZ1xuICAgKiBAcGFyYW0gY3VycmVudFRhZyAtIHRoZSB0YWcgaW4gdGhlIGl0ZXJhdGlvbiB0byBjb21wYXJlXG4gICAqIEBwYXJhbSB0YWdJdGVtIC0gdGhlIHRhZyAoYWxyZWFkeSBzZWxlY3RlZCkgdG8gY29tcGFyZSB3aXRoXG4gICAqIEBwYXJhbSBjb25maWcgLSB0aGUgY29uZmlnIHByb3ZpZGVkIHRvIHRoZSBBbmd1bGFyIFRhZ3MgSW5wdXQgY29tcG9uZW50XG4gICAqIEByZXR1cm4gYm9vbGVhbiAtIGlmIHRoZSB0YWdzIHBhc3NlZCBhcmUgdGhlIHNhbWUuXG4gICAqL1xuICBhcmVUYWdzTWF0Y2hpbmcoY3VycmVudFRhZywgdGFnSXRlbSwgY29uZmlnKSB7XG4gICAgaWYgKHR5cGVvZiB0YWdJdGVtW2NvbmZpZy5pZGVudGlmaWVyXSA9PT0gJ251bWJlcicpIHtcbiAgICAgIC8vIGhhbmRsaW5nIGlmIHRoZSB0eXBlIG9mIGlkZW50aWZpZXIgaXMgYSBudW1iZXJcbiAgICAgIHJldHVybiB0YWdJdGVtW2NvbmZpZy5pZGVudGlmaWVyXSA9PT0gK2N1cnJlbnRUYWdbY29uZmlnLmlkZW50aWZpZXJdO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHRhZ0l0ZW1bY29uZmlnLmlkZW50aWZpZXJdID09PSAnc3RyaW5nJyAmJiB0eXBlb2YgY3VycmVudFRhZ1tjb25maWcuaWRlbnRpZmllcl0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAvLyBoYW5kbGluZyBpZiB0aGUgdHlwZSBvZiBpZGVudGlmaWVyIGlzIGEgc3RyaW5nXG4gICAgICByZXR1cm4gdGFnSXRlbVtjb25maWcuaWRlbnRpZmllcl0udG9Mb3dlckNhc2UoKSA9PT0gY3VycmVudFRhZ1tjb25maWcuaWRlbnRpZmllcl0udG9Mb3dlckNhc2UoKTtcbiAgICB9XG4gIH1cblxuICBzZXRTZWxlY3RlZFRhZ3ModGFncywgY29uZmlnOiBBbmd1bGFyVGFnc0lucHV0Q29uZmlnLCB0YWdzQWRkZWQsIGlzU2VsZWN0ZWQgPSBudWxsKSB7XG4gICAgcmV0dXJuIHRhZ3MubWFwKGN1cnJlbnRUYWcgPT4ge1xuICAgICAgY3VycmVudFRhZy50aVNlbGVjdGVkID0gISF0aGlzLmlzVGFnQWxyZWFkeVNlbGVjdGVkKGN1cnJlbnRUYWcsIHRhZ3NBZGRlZCwgY29uZmlnKTtcbiAgICAgIGlmIChjb25maWcuc2hvd1RhZ3NTZWxlY3RlZEluREQgJiYgISFpc1NlbGVjdGVkKSB7XG4gICAgICAgIGN1cnJlbnRUYWcudGlTZWxlY3RlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoY3VycmVudFRhZ1tjb25maWcubmVzdGVkVGFnUHJvcGVydHldICYmIGN1cnJlbnRUYWdbY29uZmlnLm5lc3RlZFRhZ1Byb3BlcnR5XS5sZW5ndGgpIHtcbiAgICAgICAgY3VycmVudFRhZ1tjb25maWcubmVzdGVkVGFnUHJvcGVydHldID0gdGhpcy5zZXRTZWxlY3RlZFRhZ3MoXG4gICAgICAgICAgY3VycmVudFRhZ1tjb25maWcubmVzdGVkVGFnUHJvcGVydHldLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICB0YWdzQWRkZWQsXG4gICAgICAgICAgY3VycmVudFRhZy50aVNlbGVjdGVkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY3VycmVudFRhZztcbiAgICB9KTtcbiAgfVxuXG59XG4iXX0=