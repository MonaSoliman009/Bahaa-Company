{"version":3,"file":"raven-sticky-sidebar.js","sources":["ng://raven-sticky-sidebar/lib/sticky-sidebar.service.ts","ng://raven-sticky-sidebar/lib/sticky-sidebar.component.ts","ng://raven-sticky-sidebar/lib/sticky-sidebar.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StickySidebarService {\n\n  constructor() { }\n}\n","import { Component, OnInit, ElementRef, ViewChild, Input } from '@angular/core';\n\n@Component({\n  selector: 'raven-sticky-sidebar',\n  template: `<div #wrapper class=\"ss-wrapper\"><ng-content></ng-content></div>`,\n  styleUrls: ['sticky-sidebar.component.css']\n})\nexport class StickySidebarComponent implements OnInit {\n  @Input('topOffset')\n  customTopOffset: number;\n\n  @ViewChild('wrapper', { static: true })\n  wrapperElementRef: ElementRef;\n\n  private _containerElement: HTMLElement;\n  private _wrapperElement: HTMLDivElement;\n  private _initialTopOffset: number;\n  private _scrollTop: number;\n  private _scrollDirection: 'up' | 'down'\n\n  constructor(\n    private _hostElementRef: ElementRef\n  ) {\n    this.customTopOffset = 0;\n    this._containerElement = document.documentElement;\n    this._scrollTop = 0;\n    this._scrollDirection = 'down';\n  }\n\n  @Input('container')\n  set containerSelector(value: string) {\n    this._containerElement = document.querySelector(value);\n\n    if (this._wrapperElement) {\n      this.reset();\n    }\n  }\n\n  ngOnInit() {\n    this._wrapperElement = <HTMLDivElement>this.wrapperElementRef.nativeElement;\n\n    this.reset();\n    this.addScrollListener();\n    this.addResizeListener();\n  }\n\n  /**\n   * Resets sidebar based on current conditions.\n   */\n  reset() {\n    const hostElement = <HTMLDivElement>this._hostElementRef.nativeElement;\n\n    hostElement.style.minHeight = '0';\n\n    this.setSidebarHeight();\n    this.initTopOffset();\n\n    this._scrollTop = this._containerElement.scrollTop;\n  }\n\n  /**\n   * Ensures the minimum height of the sidebar is the same as the container\n   * when floats are used.\n   */\n  setSidebarHeight(height?: number) {\n    const hostElement = <HTMLDivElement>this._hostElementRef.nativeElement;\n\n    if (getComputedStyle(hostElement).cssFloat === 'none') {\n      return;\n    }\n\n    let containerHeight: number;\n\n    if (height) {\n      containerHeight = height;\n    } else {\n      containerHeight = (this._containerElement === document.documentElement) ?\n        hostElement.parentElement.offsetHeight :\n        this.getContentBoxHeight(this._containerElement);\n    }\n\n    hostElement.style.minHeight = containerHeight + 'px';\n\n    if (this._containerElement !== document.documentElement) {\n      // Height change may have changed container height\n      const newContainerHeight = this.getContentBoxHeight(this._containerElement);\n\n      if (hostElement.offsetHeight < newContainerHeight) {\n        this.setSidebarHeight(newContainerHeight);\n      }\n    }\n  }\n\n  /**\n   * Initializes the \"top\" CSS property of the wrapper element.\n   */\n  initTopOffset() {\n    // Measure container and wrapper height\n    const containerHeight = this.getContentBoxHeight(this._containerElement, true);\n    const wrapperHeight = this._wrapperElement.offsetHeight;\n\n    // Set top offset\n    const topOffset = (wrapperHeight - containerHeight) * -1;\n\n    this._initialTopOffset = (topOffset < this.customTopOffset) ?\n      topOffset :\n      this.customTopOffset;\n    this._wrapperElement.style.top = this._initialTopOffset + 'px';\n  }\n\n  /**\n   * Watches the scroll event and adjusts the \"top\" CSS property of the wrapper\n   * element.\n   */\n  addScrollListener() {\n    const scrollElement = (this._containerElement === document.documentElement) ?\n      window :\n      this._containerElement;\n\n    scrollElement.addEventListener('scroll', () => {\n      requestAnimationFrame(() => {\n        const topOffset = parseInt(this._wrapperElement.style.top);\n\n        const newScrollTop = this._containerElement.scrollTop;\n        const scrollDistance = newScrollTop - this._scrollTop;\n\n        this._scrollDirection = (scrollDistance > 0) ? 'down' : 'up';\n        this._scrollTop = this._containerElement.scrollTop;\n\n        if (this._scrollDirection === 'down') {\n          if (topOffset - scrollDistance <= this._initialTopOffset) {\n            this._wrapperElement.style.top = this._initialTopOffset + 'px';\n          } else {\n            this._wrapperElement.style.top =\n              (topOffset - scrollDistance) + 'px';\n          }\n        } else {\n          if (topOffset - scrollDistance >= this.customTopOffset) {\n            this._wrapperElement.style.top = this.customTopOffset + 'px';\n          } else if (newScrollTop > -this._initialTopOffset) {\n            this._wrapperElement.style.top = (topOffset - scrollDistance) + 'px';\n          }\n        }\n      });\n    });\n  }\n\n  /**\n   * Watches the window.resize event and resets sidebar.\n   */\n  addResizeListener() {\n    window.addEventListener('resize', () => {\n      requestAnimationFrame(() => this.reset());\n    });\n  }\n\n  /**\n   * Returns the height of an element without padding or borders.\n   * @param element The element to use.\n   * @param limitToViewport Whether to use the full height or limit the height\n   *                        to the height of the viewport.\n   */\n  getContentBoxHeight(element: HTMLElement, limitToViewport = false): number {\n    const styles = getComputedStyle(element);\n    const outerHeight = (limitToViewport) ?\n      element.clientHeight :\n      element.offsetHeight;\n    const padding = parseInt(styles.paddingTop) +\n      parseInt(styles.paddingBottom);\n    const borders = parseInt(styles.borderTopWidth) +\n      parseInt(styles.borderBottomWidth);\n    const innerHeight = outerHeight - padding - borders;\n\n    return innerHeight;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { StickySidebarComponent } from './sticky-sidebar.component';\n\n@NgModule({\n  declarations: [StickySidebarComponent],\n  imports: [\n  ],\n  exports: [StickySidebarComponent]\n})\nexport class StickySidebarModule { }\n"],"names":[],"mappings":";;;;;;AAAA,MAKa,oBAAoB;IAE/B,iBAAiB;;;YALlB,UAAU,SAAC;gBACV,UAAU,EAAE,MAAM;aACnB;;;;;;;;;;ACJD,MAOa,sBAAsB;;;;IAajC,YACU,eAA2B;QAA3B,oBAAe,GAAf,eAAe,CAAY;QAEnC,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAC,eAAe,CAAC;QAClD,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,gBAAgB,GAAG,MAAM,CAAC;KAChC;;;;;IAED,IACI,iBAAiB,CAAC,KAAa;QACjC,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAEvD,IAAI,IAAI,CAAC,eAAe,EAAE;YACxB,IAAI,CAAC,KAAK,EAAE,CAAC;SACd;KACF;;;;IAED,QAAQ;QACN,IAAI,CAAC,eAAe,sBAAmB,IAAI,CAAC,iBAAiB,CAAC,aAAa,EAAA,CAAC;QAE5E,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,iBAAiB,EAAE,CAAC;KAC1B;;;;;IAKD,KAAK;;cACG,WAAW,sBAAmB,IAAI,CAAC,eAAe,CAAC,aAAa,EAAA;QAEtE,WAAW,CAAC,KAAK,CAAC,SAAS,GAAG,GAAG,CAAC;QAElC,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC,aAAa,EAAE,CAAC;QAErB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC;KACpD;;;;;;;IAMD,gBAAgB,CAAC,MAAe;;cACxB,WAAW,sBAAmB,IAAI,CAAC,eAAe,CAAC,aAAa,EAAA;QAEtE,IAAI,gBAAgB,CAAC,WAAW,CAAC,CAAC,QAAQ,KAAK,MAAM,EAAE;YACrD,OAAO;SACR;;YAEG,eAAuB;QAE3B,IAAI,MAAM,EAAE;YACV,eAAe,GAAG,MAAM,CAAC;SAC1B;aAAM;YACL,eAAe,GAAG,CAAC,IAAI,CAAC,iBAAiB,KAAK,QAAQ,CAAC,eAAe;gBACpE,WAAW,CAAC,aAAa,CAAC,YAAY;gBACtC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;SACpD;QAED,WAAW,CAAC,KAAK,CAAC,SAAS,GAAG,eAAe,GAAG,IAAI,CAAC;QAErD,IAAI,IAAI,CAAC,iBAAiB,KAAK,QAAQ,CAAC,eAAe,EAAE;;;kBAEjD,kBAAkB,GAAG,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,iBAAiB,CAAC;YAE3E,IAAI,WAAW,CAAC,YAAY,GAAG,kBAAkB,EAAE;gBACjD,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC;aAC3C;SACF;KACF;;;;;IAKD,aAAa;;;cAEL,eAAe,GAAG,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC;;cACxE,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,YAAY;;;cAGjD,SAAS,GAAG,CAAC,aAAa,GAAG,eAAe,IAAI,CAAC,CAAC;QAExD,IAAI,CAAC,iBAAiB,GAAG,CAAC,SAAS,GAAG,IAAI,CAAC,eAAe;YACxD,SAAS;YACT,IAAI,CAAC,eAAe,CAAC;QACvB,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;KAChE;;;;;;IAMD,iBAAiB;;cACT,aAAa,GAAG,CAAC,IAAI,CAAC,iBAAiB,KAAK,QAAQ,CAAC,eAAe;YACxE,MAAM;YACN,IAAI,CAAC,iBAAiB;QAExB,aAAa,CAAC,gBAAgB,CAAC,QAAQ;;;QAAE;YACvC,qBAAqB;;;YAAC;;sBACd,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG,CAAC;;sBAEpD,YAAY,GAAG,IAAI,CAAC,iBAAiB,CAAC,SAAS;;sBAC/C,cAAc,GAAG,YAAY,GAAG,IAAI,CAAC,UAAU;gBAErD,IAAI,CAAC,gBAAgB,GAAG,CAAC,cAAc,GAAG,CAAC,IAAI,MAAM,GAAG,IAAI,CAAC;gBAC7D,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC;gBAEnD,IAAI,IAAI,CAAC,gBAAgB,KAAK,MAAM,EAAE;oBACpC,IAAI,SAAS,GAAG,cAAc,IAAI,IAAI,CAAC,iBAAiB,EAAE;wBACxD,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;qBAChE;yBAAM;wBACL,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG;4BAC5B,CAAC,SAAS,GAAG,cAAc,IAAI,IAAI,CAAC;qBACvC;iBACF;qBAAM;oBACL,IAAI,SAAS,GAAG,cAAc,IAAI,IAAI,CAAC,eAAe,EAAE;wBACtD,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;qBAC9D;yBAAM,IAAI,YAAY,GAAG,CAAC,IAAI,CAAC,iBAAiB,EAAE;wBACjD,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,SAAS,GAAG,cAAc,IAAI,IAAI,CAAC;qBACtE;iBACF;aACF,EAAC,CAAC;SACJ,EAAC,CAAC;KACJ;;;;;IAKD,iBAAiB;QACf,MAAM,CAAC,gBAAgB,CAAC,QAAQ;;;QAAE;YAChC,qBAAqB;;;YAAC,MAAM,IAAI,CAAC,KAAK,EAAE,EAAC,CAAC;SAC3C,EAAC,CAAC;KACJ;;;;;;;;IAQD,mBAAmB,CAAC,OAAoB,EAAE,eAAe,GAAG,KAAK;;cACzD,MAAM,GAAG,gBAAgB,CAAC,OAAO,CAAC;;cAClC,WAAW,GAAG,CAAC,eAAe;YAClC,OAAO,CAAC,YAAY;YACpB,OAAO,CAAC,YAAY;;cAChB,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,UAAU,CAAC;YACzC,QAAQ,CAAC,MAAM,CAAC,aAAa,CAAC;;cAC1B,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,cAAc,CAAC;YAC7C,QAAQ,CAAC,MAAM,CAAC,iBAAiB,CAAC;;cAC9B,WAAW,GAAG,WAAW,GAAG,OAAO,GAAG,OAAO;QAEnD,OAAO,WAAW,CAAC;KACpB;;;YA5KF,SAAS,SAAC;gBACT,QAAQ,EAAE,sBAAsB;gBAChC,QAAQ,EAAE,kEAAkE;;aAE7E;;;;YAN2B,UAAU;;;8BAQnC,KAAK,SAAC,WAAW;gCAGjB,SAAS,SAAC,SAAS,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE;gCAkBrC,KAAK,SAAC,WAAW;;;;;;;AC7BpB,MASa,mBAAmB;;;YAN/B,QAAQ,SAAC;gBACR,YAAY,EAAE,CAAC,sBAAsB,CAAC;gBACtC,OAAO,EAAE,EACR;gBACD,OAAO,EAAE,CAAC,sBAAsB,CAAC;aAClC;;;;;;;;;;;;;;;"}