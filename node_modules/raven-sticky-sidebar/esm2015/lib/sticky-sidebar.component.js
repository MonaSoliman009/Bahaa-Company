/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, ViewChild, Input } from '@angular/core';
export class StickySidebarComponent {
    /**
     * @param {?} _hostElementRef
     */
    constructor(_hostElementRef) {
        this._hostElementRef = _hostElementRef;
        this.customTopOffset = 0;
        this._containerElement = document.documentElement;
        this._scrollTop = 0;
        this._scrollDirection = 'down';
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set containerSelector(value) {
        this._containerElement = document.querySelector(value);
        if (this._wrapperElement) {
            this.reset();
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this._wrapperElement = (/** @type {?} */ (this.wrapperElementRef.nativeElement));
        this.reset();
        this.addScrollListener();
        this.addResizeListener();
    }
    /**
     * Resets sidebar based on current conditions.
     * @return {?}
     */
    reset() {
        /** @type {?} */
        const hostElement = (/** @type {?} */ (this._hostElementRef.nativeElement));
        hostElement.style.minHeight = '0';
        this.setSidebarHeight();
        this.initTopOffset();
        this._scrollTop = this._containerElement.scrollTop;
    }
    /**
     * Ensures the minimum height of the sidebar is the same as the container
     * when floats are used.
     * @param {?=} height
     * @return {?}
     */
    setSidebarHeight(height) {
        /** @type {?} */
        const hostElement = (/** @type {?} */ (this._hostElementRef.nativeElement));
        if (getComputedStyle(hostElement).cssFloat === 'none') {
            return;
        }
        /** @type {?} */
        let containerHeight;
        if (height) {
            containerHeight = height;
        }
        else {
            containerHeight = (this._containerElement === document.documentElement) ?
                hostElement.parentElement.offsetHeight :
                this.getContentBoxHeight(this._containerElement);
        }
        hostElement.style.minHeight = containerHeight + 'px';
        if (this._containerElement !== document.documentElement) {
            // Height change may have changed container height
            /** @type {?} */
            const newContainerHeight = this.getContentBoxHeight(this._containerElement);
            if (hostElement.offsetHeight < newContainerHeight) {
                this.setSidebarHeight(newContainerHeight);
            }
        }
    }
    /**
     * Initializes the "top" CSS property of the wrapper element.
     * @return {?}
     */
    initTopOffset() {
        // Measure container and wrapper height
        /** @type {?} */
        const containerHeight = this.getContentBoxHeight(this._containerElement, true);
        /** @type {?} */
        const wrapperHeight = this._wrapperElement.offsetHeight;
        // Set top offset
        /** @type {?} */
        const topOffset = (wrapperHeight - containerHeight) * -1;
        this._initialTopOffset = (topOffset < this.customTopOffset) ?
            topOffset :
            this.customTopOffset;
        this._wrapperElement.style.top = this._initialTopOffset + 'px';
    }
    /**
     * Watches the scroll event and adjusts the "top" CSS property of the wrapper
     * element.
     * @return {?}
     */
    addScrollListener() {
        /** @type {?} */
        const scrollElement = (this._containerElement === document.documentElement) ?
            window :
            this._containerElement;
        scrollElement.addEventListener('scroll', (/**
         * @return {?}
         */
        () => {
            requestAnimationFrame((/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                const topOffset = parseInt(this._wrapperElement.style.top);
                /** @type {?} */
                const newScrollTop = this._containerElement.scrollTop;
                /** @type {?} */
                const scrollDistance = newScrollTop - this._scrollTop;
                this._scrollDirection = (scrollDistance > 0) ? 'down' : 'up';
                this._scrollTop = this._containerElement.scrollTop;
                if (this._scrollDirection === 'down') {
                    if (topOffset - scrollDistance <= this._initialTopOffset) {
                        this._wrapperElement.style.top = this._initialTopOffset + 'px';
                    }
                    else {
                        this._wrapperElement.style.top =
                            (topOffset - scrollDistance) + 'px';
                    }
                }
                else {
                    if (topOffset - scrollDistance >= this.customTopOffset) {
                        this._wrapperElement.style.top = this.customTopOffset + 'px';
                    }
                    else if (newScrollTop > -this._initialTopOffset) {
                        this._wrapperElement.style.top = (topOffset - scrollDistance) + 'px';
                    }
                }
            }));
        }));
    }
    /**
     * Watches the window.resize event and resets sidebar.
     * @return {?}
     */
    addResizeListener() {
        window.addEventListener('resize', (/**
         * @return {?}
         */
        () => {
            requestAnimationFrame((/**
             * @return {?}
             */
            () => this.reset()));
        }));
    }
    /**
     * Returns the height of an element without padding or borders.
     * @param {?} element The element to use.
     * @param {?=} limitToViewport Whether to use the full height or limit the height
     *                        to the height of the viewport.
     * @return {?}
     */
    getContentBoxHeight(element, limitToViewport = false) {
        /** @type {?} */
        const styles = getComputedStyle(element);
        /** @type {?} */
        const outerHeight = (limitToViewport) ?
            element.clientHeight :
            element.offsetHeight;
        /** @type {?} */
        const padding = parseInt(styles.paddingTop) +
            parseInt(styles.paddingBottom);
        /** @type {?} */
        const borders = parseInt(styles.borderTopWidth) +
            parseInt(styles.borderBottomWidth);
        /** @type {?} */
        const innerHeight = outerHeight - padding - borders;
        return innerHeight;
    }
}
StickySidebarComponent.decorators = [
    { type: Component, args: [{
                selector: 'raven-sticky-sidebar',
                template: `<div #wrapper class="ss-wrapper"><ng-content></ng-content></div>`,
                styles: [".ss-wrapper{position:-webkit-sticky;position:sticky;top:0}"]
            }] }
];
/** @nocollapse */
StickySidebarComponent.ctorParameters = () => [
    { type: ElementRef }
];
StickySidebarComponent.propDecorators = {
    customTopOffset: [{ type: Input, args: ['topOffset',] }],
    wrapperElementRef: [{ type: ViewChild, args: ['wrapper', { static: true },] }],
    containerSelector: [{ type: Input, args: ['container',] }]
};
if (false) {
    /** @type {?} */
    StickySidebarComponent.prototype.customTopOffset;
    /** @type {?} */
    StickySidebarComponent.prototype.wrapperElementRef;
    /**
     * @type {?}
     * @private
     */
    StickySidebarComponent.prototype._containerElement;
    /**
     * @type {?}
     * @private
     */
    StickySidebarComponent.prototype._wrapperElement;
    /**
     * @type {?}
     * @private
     */
    StickySidebarComponent.prototype._initialTopOffset;
    /**
     * @type {?}
     * @private
     */
    StickySidebarComponent.prototype._scrollTop;
    /**
     * @type {?}
     * @private
     */
    StickySidebarComponent.prototype._scrollDirection;
    /**
     * @type {?}
     * @private
     */
    StickySidebarComponent.prototype._hostElementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RpY2t5LXNpZGViYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vcmF2ZW4tc3RpY2t5LXNpZGViYXIvIiwic291cmNlcyI6WyJsaWIvc3RpY2t5LXNpZGViYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFVBQVUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBT2hGLE1BQU0sT0FBTyxzQkFBc0I7Ozs7SUFhakMsWUFDVSxlQUEyQjtRQUEzQixvQkFBZSxHQUFmLGVBQWUsQ0FBWTtRQUVuQyxJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsaUJBQWlCLEdBQUcsUUFBUSxDQUFDLGVBQWUsQ0FBQztRQUNsRCxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsTUFBTSxDQUFDO0lBQ2pDLENBQUM7Ozs7O0lBRUQsSUFDSSxpQkFBaUIsQ0FBQyxLQUFhO1FBQ2pDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXZELElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN4QixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDZDtJQUNILENBQUM7Ozs7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLGVBQWUsR0FBRyxtQkFBZ0IsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsRUFBQSxDQUFDO1FBRTVFLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNiLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBS0QsS0FBSzs7Y0FDRyxXQUFXLEdBQUcsbUJBQWdCLElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYSxFQUFB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LENBQUM7WUFDckMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sQ0FBQyxZQUFZOztjQUNoQixPQUFPLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7WUFDekMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7O2NBQzFCLE9BQU8sR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQztZQUM3QyxRQUFRLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDOztjQUM5QixXQUFXLEdBQUcsV0FBVyxHQUFHLE9BQU8sR0FBRyxPQUFPO1FBRW5ELE9BQU8sV0FBVyxDQUFDO0lBQ3JCLENBQUM7OztZQTVLRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHNCQUFzQjtnQkFDaEMsUUFBUSxFQUFFLGtFQUFrRTs7YUFFN0U7Ozs7WUFOMkIsVUFBVTs7OzhCQVFuQyxLQUFLLFNBQUMsV0FBVztnQ0FHakIsU0FBUyxTQUFDLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0NBa0JyQyxLQUFLLFNBQUMsV0FBVzs7OztJQXJCbEIsaURBQ3dCOztJQUV4QixtREFDOEI7Ozs7O0lBRTlCLG1EQUF1Qzs7Ozs7SUFDdkMsaURBQXdDOzs7OztJQUN4QyxtREFBa0M7Ozs7O0lBQ2xDLDRDQUEyQjs7Ozs7SUFDM0Isa0RBQXVDOzs7OztJQUdyQyxpREFBbUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdyYXZlbi1zdGlja3ktc2lkZWJhcicsXG4gIHRlbXBsYXRlOiBgPGRpdiAjd3JhcHBlciBjbGFzcz1cInNzLXdyYXBwZXJcIj48bmctY29udGVudD48L25nLWNvbnRlbnQ+PC9kaXY+YCxcbiAgc3R5bGVVcmxzOiBbJ3N0aWNreS1zaWRlYmFyLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBTdGlja3lTaWRlYmFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCd0b3BPZmZzZXQnKVxuICBjdXN0b21Ub3BPZmZzZXQ6IG51bWJlcjtcblxuICBAVmlld0NoaWxkKCd3cmFwcGVyJywgeyBzdGF0aWM6IHRydWUgfSlcbiAgd3JhcHBlckVsZW1lbnRSZWY6IEVsZW1lbnRSZWY7XG5cbiAgcHJpdmF0ZSBfY29udGFpbmVyRWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gIHByaXZhdGUgX3dyYXBwZXJFbGVtZW50OiBIVE1MRGl2RWxlbWVudDtcbiAgcHJpdmF0ZSBfaW5pdGlhbFRvcE9mZnNldDogbnVtYmVyO1xuICBwcml2YXRlIF9zY3JvbGxUb3A6IG51bWJlcjtcbiAgcHJpdmF0ZSBfc2Nyb2xsRGlyZWN0aW9uOiAndXAnIHwgJ2Rvd24nXG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfaG9zdEVsZW1lbnRSZWY6IEVsZW1lbnRSZWZcbiAgKSB7XG4gICAgdGhpcy5jdXN0b21Ub3BPZmZzZXQgPSAwO1xuICAgIHRoaXMuX2NvbnRhaW5lckVsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgdGhpcy5fc2Nyb2xsVG9wID0gMDtcbiAgICB0aGlzLl9zY3JvbGxEaXJlY3Rpb24gPSAnZG93bic7XG4gIH1cblxuICBASW5wdXQoJ2NvbnRhaW5lcicpXG4gIHNldCBjb250YWluZXJTZWxlY3Rvcih2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5fY29udGFpbmVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodmFsdWUpO1xuXG4gICAgaWYgKHRoaXMuX3dyYXBwZXJFbGVtZW50KSB7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5fd3JhcHBlckVsZW1lbnQgPSA8SFRNTERpdkVsZW1lbnQ+dGhpcy53cmFwcGVyRWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuXG4gICAgdGhpcy5yZXNldCgpO1xuICAgIHRoaXMuYWRkU2Nyb2xsTGlzdGVuZXIoKTtcbiAgICB0aGlzLmFkZFJlc2l6ZUxpc3RlbmVyKCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXRzIHNpZGViYXIgYmFzZWQgb24gY3VycmVudCBjb25kaXRpb25zLlxuICAgKi9cbiAgcmVzZXQoKSB7XG4gICAgY29uc3QgaG9zdEVsZW1lbnQgPSA8SFRNTERpdkVsZW1lbnQ+dGhpcy5faG9zdEVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcblxuICAgIGhvc3RFbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9ICcwJztcblxuICAgIHRoaXMuc2V0U2lkZWJhckhlaWdodCgpO1xuICAgIHRoaXMuaW5pdFRvcE9mZnNldCgpO1xuXG4gICAgdGhpcy5fc2Nyb2xsVG9wID0gdGhpcy5fY29udGFpbmVyRWxlbWVudC5zY3JvbGxUb3A7XG4gIH1cblxuICAvKipcbiAgICogRW5zdXJlcyB0aGUgbWluaW11bSBoZWlnaHQgb2YgdGhlIHNpZGViYXIgaXMgdGhlIHNhbWUgYXMgdGhlIGNvbnRhaW5lclxuICAgKiB3aGVuIGZsb2F0cyBhcmUgdXNlZC5cbiAgICovXG4gIHNldFNpZGViYXJIZWlnaHQoaGVpZ2h0PzogbnVtYmVyKSB7XG4gICAgY29uc3QgaG9zdEVsZW1lbnQgPSA8SFRNTERpdkVsZW1lbnQ+dGhpcy5faG9zdEVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcblxuICAgIGlmIChnZXRDb21wdXRlZFN0eWxlKGhvc3RFbGVtZW50KS5jc3NGbG9hdCA9PT0gJ25vbmUnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGNvbnRhaW5lckhlaWdodDogbnVtYmVyO1xuXG4gICAgaWYgKGhlaWdodCkge1xuICAgICAgY29udGFpbmVySGVpZ2h0ID0gaGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250YWluZXJIZWlnaHQgPSAodGhpcy5fY29udGFpbmVyRWxlbWVudCA9PT0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSA/XG4gICAgICAgIGhvc3RFbGVtZW50LnBhcmVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0IDpcbiAgICAgICAgdGhpcy5nZXRDb250ZW50Qm94SGVpZ2h0KHRoaXMuX2NvbnRhaW5lckVsZW1lbnQpO1xuICAgIH1cblxuICAgIGhvc3RFbGVtZW50LnN0eWxlLm1pbkhlaWdodCA9IGNvbnRhaW5lckhlaWdodCArICdweCc7XG5cbiAgICBpZiAodGhpcy5fY29udGFpbmVyRWxlbWVudCAhPT0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgICAvLyBIZWlnaHQgY2hhbmdlIG1heSBoYXZlIGNoYW5nZWQgY29udGFpbmVyIGhlaWdodFxuICAgICAgY29uc3QgbmV3Q29udGFpbmVySGVpZ2h0ID0gdGhpcy5nZXRDb250ZW50Qm94SGVpZ2h0KHRoaXMuX2NvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgICBpZiAoaG9zdEVsZW1lbnQub2Zmc2V0SGVpZ2h0IDwgbmV3Q29udGFpbmVySGVpZ2h0KSB7XG4gICAgICAgIHRoaXMuc2V0U2lkZWJhckhlaWdodChuZXdDb250YWluZXJIZWlnaHQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgXCJ0b3BcIiBDU1MgcHJvcGVydHkgb2YgdGhlIHdyYXBwZXIgZWxlbWVudC5cbiAgICovXG4gIGluaXRUb3BPZmZzZXQoKSB7XG4gICAgLy8gTWVhc3VyZSBjb250YWluZXIgYW5kIHdyYXBwZXIgaGVpZ2h0XG4gICAgY29uc3QgY29udGFpbmVySGVpZ2h0ID0gdGhpcy5nZXRDb250ZW50Qm94SGVpZ2h0KHRoaXMuX2NvbnRhaW5lckVsZW1lbnQsIHRydWUpO1xuICAgIGNvbnN0IHdyYXBwZXJIZWlnaHQgPSB0aGlzLl93cmFwcGVyRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG5cbiAgICAvLyBTZXQgdG9wIG9mZnNldFxuICAgIGNvbnN0IHRvcE9mZnNldCA9ICh3cmFwcGVySGVpZ2h0IC0gY29udGFpbmVySGVpZ2h0KSAqIC0xO1xuXG4gICAgdGhpcy5faW5pdGlhbFRvcE9mZnNldCA9ICh0b3BPZmZzZXQgPCB0aGlzLmN1c3RvbVRvcE9mZnNldCkgP1xuICAgICAgdG9wT2Zmc2V0IDpcbiAgICAgIHRoaXMuY3VzdG9tVG9wT2Zmc2V0O1xuICAgIHRoaXMuX3dyYXBwZXJFbGVtZW50LnN0eWxlLnRvcCA9IHRoaXMuX2luaXRpYWxUb3BPZmZzZXQgKyAncHgnO1xuICB9XG5cbiAgLyoqXG4gICAqIFdhdGNoZXMgdGhlIHNjcm9sbCBldmVudCBhbmQgYWRqdXN0cyB0aGUgXCJ0b3BcIiBDU1MgcHJvcGVydHkgb2YgdGhlIHdyYXBwZXJcbiAgICogZWxlbWVudC5cbiAgICovXG4gIGFkZFNjcm9sbExpc3RlbmVyKCkge1xuICAgIGNvbnN0IHNjcm9sbEVsZW1lbnQgPSAodGhpcy5fY29udGFpbmVyRWxlbWVudCA9PT0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSA/XG4gICAgICB3aW5kb3cgOlxuICAgICAgdGhpcy5fY29udGFpbmVyRWxlbWVudDtcblxuICAgIHNjcm9sbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4ge1xuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgY29uc3QgdG9wT2Zmc2V0ID0gcGFyc2VJbnQodGhpcy5fd3JhcHBlckVsZW1lbnQuc3R5bGUudG9wKTtcblxuICAgICAgICBjb25zdCBuZXdTY3JvbGxUb3AgPSB0aGlzLl9jb250YWluZXJFbGVtZW50LnNjcm9sbFRvcDtcbiAgICAgICAgY29uc3Qgc2Nyb2xsRGlzdGFuY2UgPSBuZXdTY3JvbGxUb3AgLSB0aGlzLl9zY3JvbGxUb3A7XG5cbiAgICAgICAgdGhpcy5fc2Nyb2xsRGlyZWN0aW9uID0gKHNjcm9sbERpc3RhbmNlID4gMCkgPyAnZG93bicgOiAndXAnO1xuICAgICAgICB0aGlzLl9zY3JvbGxUb3AgPSB0aGlzLl9jb250YWluZXJFbGVtZW50LnNjcm9sbFRvcDtcblxuICAgICAgICBpZiAodGhpcy5fc2Nyb2xsRGlyZWN0aW9uID09PSAnZG93bicpIHtcbiAgICAgICAgICBpZiAodG9wT2Zmc2V0IC0gc2Nyb2xsRGlzdGFuY2UgPD0gdGhpcy5faW5pdGlhbFRvcE9mZnNldCkge1xuICAgICAgICAgICAgdGhpcy5fd3JhcHBlckVsZW1lbnQuc3R5bGUudG9wID0gdGhpcy5faW5pdGlhbFRvcE9mZnNldCArICdweCc7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3dyYXBwZXJFbGVtZW50LnN0eWxlLnRvcCA9XG4gICAgICAgICAgICAgICh0b3BPZmZzZXQgLSBzY3JvbGxEaXN0YW5jZSkgKyAncHgnO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodG9wT2Zmc2V0IC0gc2Nyb2xsRGlzdGFuY2UgPj0gdGhpcy5jdXN0b21Ub3BPZmZzZXQpIHtcbiAgICAgICAgICAgIHRoaXMuX3dyYXBwZXJFbGVtZW50LnN0eWxlLnRvcCA9IHRoaXMuY3VzdG9tVG9wT2Zmc2V0ICsgJ3B4JztcbiAgICAgICAgICB9IGVsc2UgaWYgKG5ld1Njcm9sbFRvcCA+IC10aGlzLl9pbml0aWFsVG9wT2Zmc2V0KSB7XG4gICAgICAgICAgICB0aGlzLl93cmFwcGVyRWxlbWVudC5zdHlsZS50b3AgPSAodG9wT2Zmc2V0IC0gc2Nyb2xsRGlzdGFuY2UpICsgJ3B4JztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFdhdGNoZXMgdGhlIHdpbmRvdy5yZXNpemUgZXZlbnQgYW5kIHJlc2V0cyBzaWRlYmFyLlxuICAgKi9cbiAgYWRkUmVzaXplTGlzdGVuZXIoKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLnJlc2V0KCkpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGhlaWdodCBvZiBhbiBlbGVtZW50IHdpdGhvdXQgcGFkZGluZyBvciBib3JkZXJzLlxuICAgKiBAcGFyYW0gZWxlbWVudCBUaGUgZWxlbWVudCB0byB1c2UuXG4gICAqIEBwYXJhbSBsaW1pdFRvVmlld3BvcnQgV2hldGhlciB0byB1c2UgdGhlIGZ1bGwgaGVpZ2h0IG9yIGxpbWl0IHRoZSBoZWlnaHRcbiAgICogICAgICAgICAgICAgICAgICAgICAgICB0byB0aGUgaGVpZ2h0IG9mIHRoZSB2aWV3cG9ydC5cbiAgICovXG4gIGdldENvbnRlbnRCb3hIZWlnaHQoZWxlbWVudDogSFRNTEVsZW1lbnQsIGxpbWl0VG9WaWV3cG9ydCA9IGZhbHNlKTogbnVtYmVyIHtcbiAgICBjb25zdCBzdHlsZXMgPSBnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpO1xuICAgIGNvbnN0IG91dGVySGVpZ2h0ID0gKGxpbWl0VG9WaWV3cG9ydCkgP1xuICAgICAgZWxlbWVudC5jbGllbnRIZWlnaHQgOlxuICAgICAgZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgY29uc3QgcGFkZGluZyA9IHBhcnNlSW50KHN0eWxlcy5wYWRkaW5nVG9wKSArXG4gICAgICBwYXJzZUludChzdHlsZXMucGFkZGluZ0JvdHRvbSk7XG4gICAgY29uc3QgYm9yZGVycyA9IHBhcnNlSW50KHN0eWxlcy5ib3JkZXJUb3BXaWR0aCkgK1xuICAgICAgcGFyc2VJbnQoc3R5bGVzLmJvcmRlckJvdHRvbVdpZHRoKTtcbiAgICBjb25zdCBpbm5lckhlaWdodCA9IG91dGVySGVpZ2h0IC0gcGFkZGluZyAtIGJvcmRlcnM7XG5cbiAgICByZXR1cm4gaW5uZXJIZWlnaHQ7XG4gIH1cbn1cbiJdfQ==